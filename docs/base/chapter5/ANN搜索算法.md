## ANN搜索算法
聪明的你已经知道暴力搜索是如何工作的：当你要搜索一个向量时，它会计算这个查询向量与数据库中所有其他向量的相似度（如欧氏距离或余弦相似度），然后排序返回最相似的前K个结果.这种方法的​​优势在于结果的绝对准确性​​，因为它比较了所有可能性。但这也是其最大的劣势，因为​​计算成本与数据量成正比​​（O(N)复杂度）
。当数据量从几千增长到百万、千万甚至亿级时，一次查询的耗时可能从毫秒级增加到分钟、小时甚至无法接受，无法满足实时应用的需求。此外，在高维空间中，所有点对之间的距离会变得非常接近，这使得区分真正近邻的难度增加，暴力搜索的效率会进一步降低，这一现象被称为“维度灾难”。具体维度灾难是怎么影响向量搜索，可以详细查看【向量搜索算法基础】这一章节。

**什么是ANN搜索？**
ANN（Approximate Nearest Neighbors）搜索是一种用于在高维空间中快速查找最近邻的算法。与暴力搜索不同，ANN搜索通过引入近似计算，在保持较高召回率的同时，显著减少了计算复杂度。ANN的核心价值在于解决了"维度灾难"问题——当数据维度和数量增加时，暴力搜索的计算复杂度呈指数级增长，而ANN通过巧妙的近似方法维持了可接受的搜索性能。

ANN算法之所以必要，正是为了打破暴力搜索在效率上的瓶颈。其核心思想是：​​牺牲微不足道的精度，换取数百倍甚至数千倍的速度提升​​。这并不是随意的妥协，而是通过智能的索引策略实现的。

## 索引类型

在向量搜索（Vector Search）中，索引（Index）是加速相似度检索的关键结构。
根据核心思想与数据组织方式，向量索引大体可以分为以下几大类👇

🧭 一、空间划分类（Spatial Partitioning）

通过划分向量空间来减少搜索范围。
代表算法：
- IVF（Inverted File Index）：使用 K-Means 将向量聚成多个簇（Cluster），搜索时只在最相近的几个簇内查找。
- K-D Tree / Ball Tree：以树结构递归划分空间，适合低维向量。
- Annoy（Approximate Nearest Neighbors Oh Yeah）：基于多棵随机投影树（Random Projection Tree），在磁盘上高效存储，适合静态数据。

> 📌 特点：粗筛效果好，速度快，但在高维空间性能下降明显。

🕸 二、图索引类（Graph-based Index）

通过构建**向量之间的邻接图（近邻关系）**来实现高效导航搜索。
代表算法：

- HNSW（Hierarchical Navigable Small World）：分层小世界图结构，搜索从稀疏层向密集层逐步细化。
- NSG（Navigating Spreading-out Graph）：通过优化边连接减少图复杂度，常用于工业大规模检索。
- NN-Descent：通过“近邻传播”逐步逼近KNN图，常用于HNSW或NSG的预构建阶段。

> 📌 特点：召回率高、延迟低，是目前性能最优的ANN索引类型之一。

⚙️ 三、量化压缩类（Quantization-based Index）

通过压缩向量存储与近似距离计算来节省资源。
代表算法：

- PQ（Product Quantization）：将高维向量分块并分别量化，使用短码近似表示原向量。
- OPQ（Optimized PQ）：在PQ基础上增加旋转优化，使量化误差更小。
- SQ（Scalar Quantization）：每个维度独立量化，简单但压缩率有限。  

> 📌 特点：极大降低内存占用，适合海量数据和资源受限场景。

🧩 四、哈希类（Hash-based Index）

通过哈希函数将相似向量映射到相同桶（Bucket），实现近似相似度检索。
代表算法：

- LSH（Locality Sensitive Hashing）：通过特定哈希函数（如随机投影）保持相似性。
- SimHash / MinHash：用于文本或稀疏特征的快速相似度匹配。

> 📌 特点：计算简单、可并行，但召回率较低，常用于粗筛阶段。

🧠 五、混合索引（Hybrid Index）

结合多种技术取长补短，以兼顾速度、精度与资源。
常见组合：

- IVF+PQ（FAISS 默认方案）：先聚类再量化，平衡性能与存储。
- HNSW+PQ：在图索引基础上进行量化，适合大规模高维检索。
- DiskANN / SPANN：结合图索引与磁盘访问优化，用于超大规模数据。

> 📌 特点：工业级应用首选方案，广泛用于 Milvus、FAISS、Weaviate、Elasticsearch dense vector 等系统。

🧮 六、基于磁盘或分布式的扩展索引

针对**超大规模数据（数十亿向量）**场景：

- DiskANN（Microsoft）：图索引 + 顺序磁盘访问优化，可在TB级数据上实现亚秒级响应。
- SPANN（Microsoft）：分布式向量搜索架构，结合多层索引与分区调度。
- ScaNN（Google）：融合空间划分与量化，优化了ANN在TPU/GPU环境下的性能。

> 📌 特点：面向分布式、超大规模、云原生向量检索。

### 📊 向量索引类型对比表

| 索引类型 | 代表算法 | 核心思想 | 优势 | 局限 |
|-----------|-----------|-----------|------|------|
| **空间划分类** | IVF, KD-Tree, Annoy | 空间划分 + 局部搜索 | 简单高效 | 高维退化 |
| **图索引类** | HNSW, NSG | 构建近邻图进行导航搜索 | 高召回率，低延迟 | 构建成本高，更新慢 |
| **量化压缩类** | PQ, OPQ, SQ | 向量压缩 + 近似距离计算 | 内存占用低，速度快 | 精度下降 |
| **哈希类** | LSH, SimHash | 哈希映射保持相似性 | 查询速度极快，可并行 | 召回率较低 |
| **混合索引** | IVF+PQ, HNSW+PQ | 融合多种索引优势 | 平衡速度、精度与存储 | 实现复杂，参数多 |
| **磁盘 / 分布式类** | DiskANN, SPANN, ScaNN | 图索引 + 磁盘优化 / 分布式调度 | 支持超大规模数据，高吞吐 | 部署复杂，对系统要求高 |

接下来，本节针对不同索引中的代表性算法进行详细介绍。

## 1.基于聚类的索引 (IVF)​

IVF（Inverted File Index）是一种基于聚类的索引方法，通过将向量空间划分为多个簇（Cluster），将每个向量分配到其所属的簇中。搜索时，只需要在与查询向量最近的簇内进行搜索，从而减少搜索范围。

想象一下在一个巨大的图书馆里找一本书。如果每一本书都没有分类，你只能从第一个书架开始，一本一本地找，这就是​​暴力搜索​​，效率极低。而一个高效的图书馆会将书籍按主题（如文学、历史、科学）分类摆放。​IVF算法采用的就是这种“分而治之”的策略​​。它的核心目标是在海量高维向量中快速找到近似最近邻，其核心思想是：​​先对全部向量进行聚类，将整个向量空间划分成若干个“簇”；搜索时，系统只需计算查询向量与各簇中心的距离，选出最接近的几个簇，然后仅在这几个簇内部进行精细搜索​​。这极大地缩小了搜索范围，从而实现了效率的飞跃。

## 2.基于图的索引 (HNSW)​



## 3.量化技术 (PQ)

## 4.其他算法
