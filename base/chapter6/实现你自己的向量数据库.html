<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æ„å»ºä½ çš„å‘é‡æ•°æ®åº“ï¼ˆä»é›¶æ‰‹å†™å®ç° Mini Vector DBï¼‰ | EasyVecDB æ•™ç¨‹</title>
    <meta name="description" content="å‘é‡æ•°æ®åº“å­¦ä¹ ä¸å®æˆ˜æŒ‡å—">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/easy-vecdb/assets/style.7PZEV1Fm.css" as="style">
    <link rel="preload stylesheet" href="/easy-vecdb/vp-icons.css" as="style">
    
    <script type="module" src="/easy-vecdb/assets/app.BWmjF2Cf.js"></script>
    <link rel="preload" href="/easy-vecdb/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/easy-vecdb/assets/chunks/theme.DvNcO5PS.js">
    <link rel="modulepreload" href="/easy-vecdb/assets/chunks/framework.CzE6cJJL.js">
    <link rel="modulepreload" href="/easy-vecdb/assets/base_chapter6_å®ç°ä½ è‡ªå·±çš„å‘é‡æ•°æ®åº“.md.Bby1XfT-.lean.js">
    <link rel="icon" href="/easy-vecdb/favicon.ico">
    <meta name="theme-color" content="#3c8772">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><div class="announcement-banner">âš ï¸ Alphaå†…æµ‹ç‰ˆæœ¬è­¦å‘Šï¼šæ­¤ä¸ºæ—©æœŸå†…éƒ¨æ„å»ºç‰ˆæœ¬ï¼Œå°šä¸å®Œæ•´ä¸”å¯èƒ½å­˜åœ¨é”™è¯¯ï¼Œæ¬¢è¿å¤§å®¶æIssueåé¦ˆé—®é¢˜æˆ–å»ºè®®ã€‚</div><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/easy-vecdb/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/easy-vecdb/favicon.ico" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>EasyVecDB æ•™ç¨‹</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/easy-vecdb/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>é¦–é¡µ</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/easy-vecdb/base/chapter1/%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>å‘é‡åŸºç¡€</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/easy-vecdb/Annoy/chapter1/Annoy%E5%85%A5%E9%97%A8%E4%B8%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Annoy æ•™ç¨‹</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/easy-vecdb/Faiss/chapter1/FAISS%E5%85%A5%E9%97%A8%E4%B8%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Faiss æ•™ç¨‹</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/easy-vecdb/Milvus/chapter1/Milvus%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%A5%E9%97%A8.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Milvus æ•™ç¨‹</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/easy-vecdb/more/chapter5/%E5%90%91%E9%87%8F.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>è¡¥å……å†…å®¹</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/easy-vecdb/projects/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>å®æˆ˜é¡¹ç›®</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/datawhalechina/easy-vecdb" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/datawhalechina/easy-vecdb" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>è¿”å›é¡¶éƒ¨</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Chapter 1 Â· é¡¹ç›®ä»‹ç»</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter1/%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>é¡¹ç›®ä»‹ç»</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter1/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84%E6%8E%A8%E8%8D%90.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>å­¦ä¹ è·¯å¾„æ¨è</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Chapter 2 Â· å‘é‡æ•°æ®åº“æ¦‚å¿µ</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter2/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ä¸ºä»€ä¹ˆéœ€è¦å‘é‡æ•°æ®åº“</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Chapter 3 Â· å‘é‡åµŒå…¥ç®—æ³•åŸºç¡€</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter3/%E5%90%91%E9%87%8F%E5%B5%8C%E5%85%A5%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>å‘é‡åµŒå…¥ç®—æ³•åŸºç¡€</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Chapter 4 Â· å‘é‡æœç´¢ç®—æ³•åŸºç¡€</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter4/%E5%90%91%E9%87%8F%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>å‘é‡æœç´¢ç®—æ³•åŸºç¡€</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Chapter 5 Â· å‘é‡ANNæœç´¢ç®—æ³•</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter5/ANN%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ANNæœç´¢ç®—æ³•</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter5/Annoy%E7%AE%97%E6%B3%95.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Annoyç®—æ³•</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter5/IVF%E7%AE%97%E6%B3%95.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>IVFç®—æ³•</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter5/HNSW%E7%AE%97%E6%B3%95.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>HNSWç®—æ³•</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter5/PQ%E7%AE%97%E6%B3%95.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>PQç®—æ³•</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter5/LSH%E7%AE%97%E6%B3%95.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>LSHç®—æ³•</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Chapter 6 Â· å®ç°ä½ è‡ªå·±çš„å‘é‡æ•°æ®åº“</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/easy-vecdb/base/chapter6/%E5%AE%9E%E7%8E%B0%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>å®ç°ä½ è‡ªå·±çš„å‘é‡æ•°æ®åº“</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _easy-vecdb_base_chapter6_%E5%AE%9E%E7%8E%B0%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93" data-v-39a288b8><div><h1 id="æ„å»ºä½ çš„å‘é‡æ•°æ®åº“-ä»é›¶æ‰‹å†™å®ç°-mini-vector-db" tabindex="-1">æ„å»ºä½ çš„å‘é‡æ•°æ®åº“ï¼ˆä»é›¶æ‰‹å†™å®ç° Mini Vector DBï¼‰ <a class="header-anchor" href="#æ„å»ºä½ çš„å‘é‡æ•°æ®åº“-ä»é›¶æ‰‹å†™å®ç°-mini-vector-db" aria-label="Permalink to &quot;æ„å»ºä½ çš„å‘é‡æ•°æ®åº“ï¼ˆä»é›¶æ‰‹å†™å®ç° Mini Vector DBï¼‰&quot;">â€‹</a></h1><p>åœ¨å‰äº”ç« ä¸­ï¼Œæˆ‘ä»¬ç³»ç»Ÿå­¦ä¹ äº†å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒæ¦‚å¿µã€åº•å±‚ç®—æ³•å’ŒæŠ€æœ¯åŸç†ã€‚æœ¬ç« å°†èšç„¦â€œå®è·µâ€ï¼Œå¸¦é¢†å¤§å®¶ç”¨Pythonæ‰‹åŠ¨å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆå‘é‡æ•°æ®åº“ï¼Œç†è§£å…¶æ ¸å¿ƒå·¥ä½œæµç¨‹ã€‚é€šè¿‡æœ¬æ¬¡å®è·µï¼Œä½ å°†æŒæ¡å‘é‡å­˜å‚¨ã€ç´¢å¼•æ„å»ºã€ç›¸ä¼¼åº¦æ£€ç´¢ç­‰æ ¸å¿ƒåŠŸèƒ½çš„å®ç°é€»è¾‘ï¼Œä¸ºåç»­ä½¿ç”¨å·¥ä¸šçº§å‘é‡æ•°æ®åº“æ‰“ä¸‹åšå®åŸºç¡€ã€‚</p><p>å­¦ä¹ ç›®æ ‡ï¼š</p><blockquote><p>æœ¬ç« ç›®æ ‡ï¼šæŒæ¡å‘é‡æ•°æ®åº“çš„åŸºæœ¬æ¶æ„ï¼Œå¹¶é€šè¿‡ Python æ‰‹å†™å®ç°ä¸€ä¸ªå¯æ‰§è¡Œçš„è¿·ä½ ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ï¼šå‘é‡å­˜å‚¨ã€ç›¸ä¼¼åº¦æœç´¢ã€IVF ä¸ HNSW ç®€æ˜“æ¨¡æ‹Ÿç»“æ„ã€‚</p></blockquote><h2 id="_1-æ ¸å¿ƒç›®æ ‡ä¸æŠ€æœ¯é€‰å‹" tabindex="-1">1.æ ¸å¿ƒç›®æ ‡ä¸æŠ€æœ¯é€‰å‹ <a class="header-anchor" href="#_1-æ ¸å¿ƒç›®æ ‡ä¸æŠ€æœ¯é€‰å‹" aria-label="Permalink to &quot;1.æ ¸å¿ƒç›®æ ‡ä¸æŠ€æœ¯é€‰å‹&quot;">â€‹</a></h2><h3 id="_1-1-å®ç°ç›®æ ‡" tabindex="-1">1.1 å®ç°ç›®æ ‡ <a class="header-anchor" href="#_1-1-å®ç°ç›®æ ‡" aria-label="Permalink to &quot;1.1 å®ç°ç›®æ ‡&quot;">â€‹</a></h3><p>æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½çš„å‘é‡æ•°æ®åº“åŸå‹ï¼š</p><ul><li>å‘é‡æ•°æ®çš„å¢åˆ æ”¹æŸ¥ï¼ˆåŸºç¡€æ•°æ®æ“ä½œï¼‰</li><li>åŸºäºä½™å¼¦ç›¸ä¼¼åº¦çš„ç²¾ç¡®æ£€ç´¢</li><li>åŸºäºIVFï¼ˆå€’æ’æ–‡ä»¶ï¼‰çš„è¿‘ä¼¼æ£€ç´¢ï¼ˆæå‡æ£€ç´¢æ•ˆç‡ï¼‰</li><li>å‘é‡æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ï¼ˆé¿å…ç¨‹åºé€€å‡ºåæ•°æ®ä¸¢å¤±ï¼‰</li></ul><h3 id="_1-2-æŠ€æœ¯é€‰å‹" tabindex="-1">1.2 æŠ€æœ¯é€‰å‹ <a class="header-anchor" href="#_1-2-æŠ€æœ¯é€‰å‹" aria-label="Permalink to &quot;1.2 æŠ€æœ¯é€‰å‹&quot;">â€‹</a></h3><p>ä¸ºç®€åŒ–å®ç°å¹¶èšç„¦æ ¸å¿ƒé€»è¾‘ï¼Œæˆ‘ä»¬é€‰ç”¨ä»¥ä¸‹è½»é‡çº§å·¥å…·åº“ï¼š</p><ul><li>numpyï¼šæ ¸å¿ƒæ•°å€¼è®¡ç®—åº“ï¼Œç”¨äºå‘é‡çš„å­˜å‚¨ã€è¿ç®—å’Œç›¸ä¼¼åº¦è®¡ç®—</li><li>scikit-learnï¼šæä¾›KMeansèšç±»ç®—æ³•ï¼Œç”¨äºIVFç´¢å¼•çš„æ„å»ºï¼ˆå¯¹åº”Chapter 5çš„IVFç®—æ³•åŸç†ï¼‰</li><li>pickleï¼šPythonå†…ç½®åºåˆ—åŒ–å·¥å…·ï¼Œç”¨äºå‘é‡æ•°æ®å’Œç´¢å¼•çš„æŒä¹…åŒ–å­˜å‚¨</li><li>uuidï¼šç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºå‘é‡æ•°æ®çš„ä¸»é”®æ ‡è¯† å®‰è£…å‘½ä»¤ï¼š</li></ul><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> numpy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scikit-learn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sentence-transformers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> modelscope</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å‘é‡æ•°æ®åº“ä¸æ˜¯ä¸€ä¸ªâ€œç®—æ³•é›†åˆâ€ï¼Œè€Œæ˜¯ä¸€æ•´å¥—ç³»ç»Ÿï¼š</p><p>ğŸ§± å‘é‡æ•°æ®åº“æ ¸å¿ƒæ¨¡å—</p><table tabindex="0"><thead><tr><th>æ¨¡å—</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>1. å‘é‡å­˜å‚¨ï¼ˆVector Storeï¼‰</strong></td><td>å­˜å‚¨æ‰€æœ‰å‘é‡ embeddingï¼ˆé€šå¸¸ä½¿ç”¨ NumPy / mmap / GPU bufferï¼‰</td></tr><tr><td><strong>2. ç´¢å¼•ï¼ˆIndexï¼‰</strong></td><td>åŠ é€Ÿç›¸ä¼¼åº¦æœç´¢ï¼Œå¦‚ IVFã€HNSWã€PQã€LSH</td></tr><tr><td><strong>3. ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆMetricï¼‰</strong></td><td>è®¡ç®—å‘é‡ä¹‹é—´çš„è·ç¦»ï¼šCosine / L2 / Inner Product</td></tr><tr><td><strong>4. æŸ¥è¯¢å¼•æ“ï¼ˆQuery Engineï¼‰</strong></td><td>è´Ÿè´£æŸ¥è¯¢è·¯ç”±ï¼šé€‰æ‹©ç´¢å¼•ã€æ§åˆ¶ nprobeã€èšåˆå½©ç»“æœ</td></tr><tr><td><strong>5. å…ƒæ•°æ®ç®¡ç†ï¼ˆMetadataï¼‰</strong></td><td>ä¿å­˜å‘é‡å¯¹åº”çš„ IDã€æ–‡æœ¬å†…å®¹ã€æ ‡ç­¾ã€ä¸šåŠ¡å­—æ®µ</td></tr><tr><td><strong>6. æŒä¹…åŒ–ï¼ˆPersistenceï¼‰</strong></td><td>å°†å‘é‡ã€ç´¢å¼•ã€å…ƒæ•°æ®ä¿å­˜åˆ°ç£ç›˜ï¼Œæ”¯æŒ load/rebuild</td></tr></tbody></table><h2 id="_2-åˆ†æ­¥å®ç°å‘é‡æ•°æ®åº“" tabindex="-1">2.åˆ†æ­¥å®ç°å‘é‡æ•°æ®åº“ <a class="header-anchor" href="#_2-åˆ†æ­¥å®ç°å‘é‡æ•°æ®åº“" aria-label="Permalink to &quot;2.åˆ†æ­¥å®ç°å‘é‡æ•°æ®åº“&quot;">â€‹</a></h2><h3 id="_2-1åˆå§‹åŒ–æ•°æ®åº“ä¸æ•°æ®å­˜å‚¨å±‚" tabindex="-1">2.1åˆå§‹åŒ–æ•°æ®åº“ä¸æ•°æ®å­˜å‚¨å±‚ <a class="header-anchor" href="#_2-1åˆå§‹åŒ–æ•°æ®åº“ä¸æ•°æ®å­˜å‚¨å±‚" aria-label="Permalink to &quot;2.1åˆå§‹åŒ–æ•°æ®åº“ä¸æ•°æ®å­˜å‚¨å±‚&quot;">â€‹</a></h3><p>æ•°æ®å­˜å‚¨å±‚çš„æ ¸å¿ƒä½œç”¨æ˜¯ç®¡ç†åŸå§‹å‘é‡æ•°æ®åŠå¯¹åº”çš„å…ƒæ•°æ®ï¼ˆå¦‚å”¯ä¸€IDã€æè¿°ä¿¡æ¯ç­‰ï¼‰ã€‚æˆ‘ä»¬å°†ç”¨numpyæ•°ç»„å­˜å‚¨å‘é‡é›†åˆï¼Œç”¨å­—å…¸å»ºç«‹IDä¸å‘é‡ä¸‹æ ‡çš„æ˜ å°„ï¼ˆä¾¿äºå¿«é€Ÿå®šä½ï¼‰ã€‚ <strong>ä»¥ä¸‹ä»£ç éœ€æ•´åˆåˆ°åŒä¸€ä¸ªç±»ä¸­</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pickle</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uuid</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sklearn.cluster </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KMeans</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sklearn.metrics.pairwise </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cosine_similarity</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SimpleVectorDB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, vector_dim, db_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vector_db.pkl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        åˆå§‹åŒ–å‘é‡æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        :param vector_dim: å‘é‡ç»´åº¦ï¼ˆæ‰€æœ‰å…¥åº“å‘é‡å¿…é¡»ä¿æŒä¸€è‡´ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        :param db_path: æ•°æ®æŒä¹…åŒ–å­˜å‚¨è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_dim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vector_dim  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å‘é‡ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.db_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db_path        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŒä¹…åŒ–è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ•°æ®å­˜å‚¨æ ¸å¿ƒç»“æ„</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.array([])               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å­˜å‚¨æ‰€æœ‰å‘é‡ï¼ˆnumpyæ•°ç»„ï¼Œå½¢çŠ¶ä¸º[N, vector_dim]ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_ids </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []                      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å­˜å‚¨å‘é‡å”¯ä¸€IDï¼Œä¸vectorsä¸‹æ ‡ä¸€ä¸€å¯¹åº”</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ˜ å°„ï¼šå‘é‡ID â†’ å‘é‡åœ¨vectorsä¸­çš„ä¸‹æ ‡</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å­˜å‚¨å‘é‡å…ƒæ•°æ®ï¼ˆkey: å‘é‡ID, value: å…ƒæ•°æ®å­—å…¸ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç´¢å¼•ç›¸å…³ï¼ˆåç»­åˆå§‹åŒ–ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                     # IVFç´¢å¼•ç»“æ„</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_kmeans </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _check_vector_dim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, vector):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;æ ¡éªŒå‘é‡ç»´åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vector) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_dim:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ValueError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å‘é‡ç»´åº¦é”™è¯¯ï¼Œéœ€ä¸º</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_dim</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ç»´ï¼Œå½“å‰ä¸º</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vector)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ç»´&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="_2-2-å®ç°å¢åˆ æ”¹æŸ¥-api" tabindex="-1">2.2 å®ç°å¢åˆ æ”¹æŸ¥ API <a class="header-anchor" href="#_2-2-å®ç°å¢åˆ æ”¹æŸ¥-api" aria-label="Permalink to &quot;2.2 å®ç°å¢åˆ æ”¹æŸ¥ API&quot;">â€‹</a></h3><p>è¿™éƒ¨åˆ†å°†å®ç°å‘é‡çš„æ’å…¥ã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤åŠŸèƒ½ï¼Œæ˜¯æ•°æ®åº“æœ€åŸºç¡€çš„äº¤äº’èƒ½åŠ›ã€‚</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, vector, metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        æ’å…¥å‘é‡æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        :param vector: å‘é‡æ•°æ®ï¼ˆlistæˆ–numpy.ndarrayï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        :param metadata: å…ƒæ•°æ®ï¼ˆå¯é€‰ï¼Œå¦‚æ–‡æœ¬æè¿°ã€æ¥æºç­‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        :return: å‘é‡å”¯ä¸€IDï¼ˆç”¨äºåç»­æŸ¥è¯¢/æ›´æ–°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç±»å‹è½¬æ¢ä¸ç»´åº¦æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.array(vector, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">np.float32).flatten()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._check_vector_dim(vector)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç”Ÿæˆå”¯ä¸€ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vector_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uuid.uuid4())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ’å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.expand_dims(vector, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.vstack([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors, vector])</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_ids.append(vector_id)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index[vector_id] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_ids) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.metadata[vector_id] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vector_id</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_by_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, vector_id):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;é€šè¿‡IDæŸ¥è¯¢å‘é‡åŠå…ƒæ•°æ®&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vector_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> KeyError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æœªæ‰¾åˆ°IDä¸º</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vector_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">çš„å‘é‡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index[vector_id]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;vector_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: vector_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;vector&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors[index].tolist(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.metadata.get(vector_id, {})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, vector_id, new_vector</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, new_metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;æ›´æ–°å‘é‡æ•°æ®æˆ–å…ƒæ•°æ®&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vector_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> KeyError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æœªæ‰¾åˆ°IDä¸º</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vector_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">çš„å‘é‡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index[vector_id]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ›´æ–°å‘é‡ï¼ˆè‹¥æä¾›æ–°å‘é‡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new_vector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            new_vector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.array(new_vector, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">np.float32).flatten()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._check_vector_dim(new_vector)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors[index] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new_vector</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ›´æ–°å…ƒæ•°æ®ï¼ˆè‹¥æä¾›æ–°å…ƒæ•°æ®ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new_metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.metadata[vector_id] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new_metadata</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, vector_id):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;åˆ é™¤å‘é‡æ•°æ®&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vector_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> KeyError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æœªæ‰¾åˆ°IDä¸º</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vector_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">çš„å‘é‡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index[vector_id]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆ é™¤æ ¸å¿ƒæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.delete(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors, index, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_ids.pop(index)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        del</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index[vector_id]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vector_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.metadata:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            del</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.metadata[vector_id]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # é‡æ–°æ„å»ºIDä¸ä¸‹æ ‡çš„æ˜ å°„ï¼ˆå› åˆ é™¤åä¸‹æ ‡å‘ç”Ÿå˜åŒ–ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {vid: idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx, vid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_ids)}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h3 id="_2-3-å®ç°ç›¸ä¼¼åº¦æ£€ç´¢-æš´åŠ›-ivf" tabindex="-1">2.3 å®ç°ç›¸ä¼¼åº¦æ£€ç´¢ï¼ˆæš´åŠ› + IVFï¼‰ <a class="header-anchor" href="#_2-3-å®ç°ç›¸ä¼¼åº¦æ£€ç´¢-æš´åŠ›-ivf" aria-label="Permalink to &quot;2.3 å®ç°ç›¸ä¼¼åº¦æ£€ç´¢ï¼ˆæš´åŠ› + IVFï¼‰&quot;">â€‹</a></h3><p>æ£€ç´¢æ˜¯å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒä»·å€¼ï¼Œæˆ‘ä»¬å°†å…ˆå®ç°ç²¾ç¡®æ£€ç´¢ï¼ˆæš´åŠ›æ£€ç´¢ï¼‰ï¼Œå†åŸºäºIVFç®—æ³•å®ç°è¿‘ä¼¼æ£€ç´¢ï¼Œå¯¹æ¯”ä¸¤è€…çš„æ•ˆç‡å·®å¼‚ã€‚</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> brute_force_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query_vector, top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        æš´åŠ›æ£€ç´¢ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰ï¼šè®¡ç®—æŸ¥è¯¢å‘é‡ä¸æ‰€æœ‰å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        :param query_vector: æŸ¥è¯¢å‘é‡</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        :param top_k: è¿”å›ç›¸ä¼¼åº¦æœ€é«˜çš„å‰kä¸ªç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        :return: æ£€ç´¢ç»“æœï¼ˆæŒ‰ç›¸ä¼¼åº¦é™åºæ’åˆ—ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # é¢„å¤„ç†æŸ¥è¯¢å‘é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        query_vector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.array(query_vector, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">np.float32).flatten()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._check_vector_dim(query_vector)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆåˆ©ç”¨sklearnç®€åŒ–å®ç°ï¼Œä¹Ÿå¯æ‰‹åŠ¨å®ç°ï¼š(aÂ·b)/(||a||Â·||b||)ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        similarities </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cosine_similarity([query_vector], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æŒ‰ç›¸ä¼¼åº¦é™åºæ’åºï¼Œå–å‰top_k</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        top_indices </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.argsort(similarities)[::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][:top_k]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç»„è£…ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> top_indices:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vector_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_ids[idx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            results.append({</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;vector_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: vector_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;similarity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(similarities[idx]),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;vector&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors[idx].tolist(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.metadata.get(vector_id, {})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> build_ivf_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, n_clusters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        æ„å»ºIVFç´¢å¼•ï¼ˆåŸºäºKMeansèšç±»ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        æ ¸å¿ƒé€»è¾‘ï¼šå°†å‘é‡èšç±»åˆ°n_clustersä¸ªæ¡¶ä¸­ï¼Œæ£€ç´¢æ—¶å…ˆæ‰¾æŸ¥è¯¢å‘é‡æ‰€å±çš„æ¡¶ï¼Œå†åœ¨æ¡¶å†…æš´åŠ›æ£€ç´¢</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ValueError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æ•°æ®åº“ä¸­æ— å‘é‡æ•°æ®ï¼Œæ— æ³•æ„å»ºç´¢å¼•&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è½¬æ¢ä¸º float64</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vectors_for_kmeans </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors.astype(np.float64)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # KMeans èšç±»</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        kmeans </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KMeans(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">n_clusters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n_clusters, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">random_state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cluster_labels </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kmeans.fit_predict(vectors_for_kmeans)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ„å»ºIVFç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {i: [] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(n_clusters)}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx, label </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cluster_labels):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_index[label].append(idx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_kmeans </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kmeans</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ivf_search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query_vector, top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;åŸºäºIVFç´¢å¼•çš„è¿‘ä¼¼æ£€ç´¢&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ValueError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;è¯·å…ˆè°ƒç”¨build_ivf_index()æ„å»ºIVFç´¢å¼•&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 1. é¢„å¤„ç†æŸ¥è¯¢å‘é‡ï¼Œç¡®å®šå…¶æ‰€å±çš„èšç±»ï¼ˆæ¡¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        query_vector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.array(query_vector, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dtype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">np.float64).flatten()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._check_vector_dim(query_vector)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cluster_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_kmeans.predict([query_vector])[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 2. è·å–è¯¥èšç±»ä¸‹çš„æ‰€æœ‰å‘é‡ä¸‹æ ‡ï¼Œæå–å¯¹åº”å‘é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cluster_indices </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_index[cluster_id]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cluster_indices:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cluster_vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors[cluster_indices]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 3. åœ¨èšç±»å†…è®¡ç®—ç›¸ä¼¼åº¦å¹¶æ’åº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        similarities </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cosine_similarity([query_vector], cluster_vectors)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        top_cluster_indices </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.argsort(similarities)[::</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][:top_k]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 4. ç»„è£…ç»“æœï¼ˆæ˜ å°„å›åŸæ•°æ®åº“çš„å‘é‡IDï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> top_cluster_indices:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            original_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cluster_indices[idx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vector_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_ids[original_idx]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            results.append({</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;vector_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: vector_id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;similarity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(similarities[idx]),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;vector&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors[original_idx].tolist(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.metadata.get(vector_id, {}),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;cluster_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cluster_id)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ ‡æ³¨æ‰€å±èšç±»ï¼Œä¾¿äºç†è§£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><h3 id="_2-4-æ•°æ®æŒä¹…åŒ–" tabindex="-1">2.4 æ•°æ®æŒä¹…åŒ– <a class="header-anchor" href="#_2-4-æ•°æ®æŒä¹…åŒ–" aria-label="Permalink to &quot;2.4 æ•°æ®æŒä¹…åŒ–&quot;">â€‹</a></h3><p>ä¸ºé¿å…ç¨‹åºé€€å‡ºåæ•°æ®ä¸¢å¤±ï¼Œæˆ‘ä»¬éœ€è¦å°†æ ¸å¿ƒæ•°æ®ç»“æ„åºåˆ—åŒ–åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œä¸‹æ¬¡å¯åŠ¨æ—¶å†åŠ è½½ã€‚</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> save</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;å°†æ•°æ®åº“æ•°æ®ä¸ç´¢å¼•æŒä¹…åŒ–åˆ°æœ¬åœ°æ–‡ä»¶&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;vector_dim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_dim,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;vectors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vectors,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;vector_ids&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.vector_ids,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;id_to_index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id_to_index,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.metadata,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;ivf_index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_index,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;ivf_kmeans&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ivf_kmeans  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å­˜å‚¨èšç±»æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.db_path, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pickle.dump(data, f)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æ•°æ®åº“å·²ä¿å­˜è‡³</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.db_path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">classmethod</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> load</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cls, db_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vector_db.pkl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;ä»æœ¬åœ°æ–‡ä»¶åŠ è½½æ•°æ®åº“&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(db_path, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pickle.load(f)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # é‡å»ºæ•°æ®åº“å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vector_dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vector_dim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">db_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db_path)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vectors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.vector_ids </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vector_ids&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.id_to_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id_to_index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.ivf_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ivf_index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.ivf_kmeans </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ivf_kmeans&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å·²ä»</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db_path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">åŠ è½½æ•°æ®åº“ï¼Œå…±åŒ…å«</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(db.vectors)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ä¸ªå‘é‡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="_3-å®æˆ˜-ä½¿ç”¨è‡ªå®šä¹‰å‘é‡æ•°æ®åº“å®ä¹ æ–‡æœ¬å‘é‡æ£€ç´¢" tabindex="-1">3.å®æˆ˜ï¼šä½¿ç”¨è‡ªå®šä¹‰å‘é‡æ•°æ®åº“å®ä¹ æ–‡æœ¬å‘é‡æ£€ç´¢ <a class="header-anchor" href="#_3-å®æˆ˜-ä½¿ç”¨è‡ªå®šä¹‰å‘é‡æ•°æ®åº“å®ä¹ æ–‡æœ¬å‘é‡æ£€ç´¢" aria-label="Permalink to &quot;3.å®æˆ˜ï¼šä½¿ç”¨è‡ªå®šä¹‰å‘é‡æ•°æ®åº“å®ä¹ æ–‡æœ¬å‘é‡æ£€ç´¢&quot;">â€‹</a></h2><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªâ€œæ–‡æœ¬å‘é‡æ£€ç´¢â€çš„å®ä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ä¸Šé¢å®ç°çš„å‘é‡æ•°æ®åº“ã€‚</p><p>æ–‡æœ¬å‘é‡ä½¿ç”¨GTEæ–‡æœ¬å‘é‡-ä¸­æ–‡-é€šç”¨é¢†åŸŸæ¨¡å‹ï¼Œå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ã€‚ éœ€è¦å®‰è£…çš„ç¬¬ä¸‰æ–¹åŒ…</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pip install sentence-transformers modelscope</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_3-1-ä¸‹è½½æ¨¡å‹" tabindex="-1">3.1 ä¸‹è½½æ¨¡å‹ <a class="header-anchor" href="#_3-1-ä¸‹è½½æ¨¡å‹" aria-label="Permalink to &quot;3.1 ä¸‹è½½æ¨¡å‹&quot;">â€‹</a></h3><p>é¦–å…ˆæ˜¯ä½¿ç”¨modelscope ä¸‹è½½å¯¹åº”çš„æ¨¡å‹</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#æ¨¡å‹ä¸‹è½½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> modelscope </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> snapshot_download</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model_dir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> snapshot_download(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;iic/nlp_gte_sentence-embedding_chinese-base&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cache_dir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./model&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-2-åŠ è½½æ¨¡å‹" tabindex="-1">3.2 åŠ è½½æ¨¡å‹ <a class="header-anchor" href="#_3-2-åŠ è½½æ¨¡å‹" aria-label="Permalink to &quot;3.2 åŠ è½½æ¨¡å‹&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#åŠ è½½æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jieba</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sentence_transformers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SentenceTransformer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> read_txt_and_split</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file_path):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;è¯»å–txtæ–‡ä»¶å†…å®¹å¹¶åˆ‡åˆ†ä¸ºå¥å­åˆ—è¡¨&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.path.exists(file_path):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> FileNotFoundError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æŒ‡å®šçš„txtæ–‡ä»¶ä¸å­˜åœ¨ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">file_path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è¯»å–æ–‡ä»¶ï¼ˆé»˜è®¤UTF-8ç¼–ç ï¼Œè‹¥æœ‰ä¹±ç å¯å°è¯•gbkï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file_path, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;r&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">encoding</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f.read()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¥å­åˆ‡åˆ†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sentences </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æˆåŠŸè¯»å–txtæ–‡ä»¶ï¼Œå…±åˆ‡åˆ†å‡º </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sentences)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ä¸ªå¥å­&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sentences</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> text_to_vector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text, model):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼ˆåŸºäºSentenceTransformeræ¨¡å‹ï¼‰&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # encodeæ–¹æ³•ç›´æ¥è¿”å›å‘é‡ï¼Œconvert_to_numpy=Trueç¡®ä¿è¾“å‡ºä¸ºnumpyæ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.encode(text, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">convert_to_numpy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__main__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 1. é…ç½®å‚æ•°ï¼ˆè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹txtæ–‡ä»¶è·¯å¾„å’Œæ¨¡å‹è·¯å¾„ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    txt_file </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./data/Datawhaleç¤¾åŒºä»‹ç»å¤§æ¨¡å‹æ”¹å†™ç‰ˆ.txt&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ä½ çš„txtæ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model_dir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./model/iic/nlp_gte_sentence-embedding_chinese-base&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # é¢„è®­ç»ƒæ¨¡å‹æœ¬åœ°å­˜å‚¨è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    VECTOR_DIM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 768</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ä¸»æµä¸­æ–‡è¯­ä¹‰æ¨¡å‹è¾“å‡ºç»´åº¦å¤šä¸º768ï¼Œå¯æ ¹æ®å®é™…æ¨¡å‹è°ƒæ•´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 2. åŠ è½½ä¸­æ–‡è¯­ä¹‰å‘é‡æ¨¡å‹ï¼ˆä¸¤ç§åŠ è½½æ–¹å¼å¯é€‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æ­£åœ¨åŠ è½½ä¸­æ–‡æ–‡æœ¬åµŒå…¥æ¨¡å‹...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SentenceTransformer(model_dir)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æˆåŠŸåŠ è½½æœ¬åœ°æ¨¡å‹ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model_dir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 3. åˆå§‹åŒ–å‘é‡æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SimpleVectorDB(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vector_dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VECTOR_DIM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 4. è¯»å–txtæ–‡ä»¶å¹¶åˆ‡åˆ†å¥å­</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">æ­£åœ¨è¯»å–å¹¶å¤„ç†txtæ–‡ä»¶ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">txt_file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sentences </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> read_txt_and_split(txt_file)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sentences:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ValueError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æœªä»txtæ–‡ä»¶ä¸­æå–åˆ°æœ‰æ•ˆå¥å­&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 5. å¥å­è½¬å‘é‡å¹¶æ’å…¥æ•°æ®åº“ï¼ˆé™„å¸¦å…ƒæ•°æ®ï¼šåŸå§‹å¥å­ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">æ­£åœ¨å°†å¥å­è½¬å‘é‡å¹¶æ’å…¥æ•°æ®åº“...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    embeddings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.encode(sentences)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‰¹é‡ç”Ÿæˆå‘é‡ï¼Œæ•ˆç‡æ›´é«˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx, (sentence, embedding) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">zip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sentences, embeddings), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å…ƒæ•°æ®åŒ…å«å¥å­å†…å®¹å’Œåºå·ï¼Œä¾¿äºåç»­æŸ¥çœ‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sentence&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: sentence, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sequence&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: idx}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        db.insert(embedding, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">metadata)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 6. æŒä¹…åŒ–æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.save()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 7. æµ‹è¯•æš´åŠ›æ£€ç´¢ï¼ˆæŸ¥è¯¢ä¸å‘é‡æ•°æ®åº“ç›¸å…³çš„å†…å®¹ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=== æš´åŠ›æ£€ç´¢ç»“æœï¼ˆæŸ¥è¯¢ï¼š&#39;Datawhaleæœ‰å¤šä¸ªå­¦ä¹ è€…å‚ä¸æ´»åŠ¨&#39;ï¼‰===&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Datawhaleæœ‰å¤šä¸ªå­¦ä¹ è€…å‚ä¸æ´»åŠ¨&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_vector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text_to_vector(query_text, model)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    brute_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.brute_force_search(query_vector, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> brute_results:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç›¸ä¼¼åº¦ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;similarity&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:.4f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> | å¥å­ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sentence&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 8. æ„å»ºIVFç´¢å¼•å¹¶æµ‹è¯•è¿‘ä¼¼æ£€ç´¢</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=== IVFè¿‘ä¼¼æ£€ç´¢ç»“æœï¼ˆæŸ¥è¯¢ï¼š&#39;Datawhaleæœ‰å¤šä¸ªå­¦ä¹ è€…å‚ä¸æ´»åŠ¨&#39;ï¼‰===&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ ¹æ®å¥å­æ•°é‡è°ƒæ•´èšç±»æ•°ï¼ˆä¸€èˆ¬ä¸ºæ•°æ®é‡çš„å¹³æ–¹æ ¹å·¦å³ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    n_clusters </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sentences)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.build_ivf_index(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">n_clusters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n_clusters)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ivf_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.ivf_search(query_vector, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ivf_results:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç›¸ä¼¼åº¦ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;similarity&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:.4f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> | èšç±»IDï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cluster_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> | å¥å­ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sentence&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 9. æµ‹è¯•æ•°æ®æ›´æ–°ä¸æŸ¥è¯¢</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=== æ•°æ®æ›´æ–°ä¸æŸ¥è¯¢æµ‹è¯• ===&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è·å–ç¬¬ä¸€ä¸ªå‘é‡çš„IDï¼ˆå³ç¬¬ä¸€ä¸ªå¥å­å¯¹åº”çš„å‘é‡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    first_vector_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.vector_ids[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    first_sentence </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.get_by_id(first_vector_id)[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sentence&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å¾…æ›´æ–°çš„åŸå§‹å¥å­ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">first_sentence</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ›´æ–°å…¶å…ƒæ•°æ®ï¼ˆæ¨¡æ‹Ÿå¥å­ä¿®æ­£ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    new_metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sentence&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ã€ä¿®æ­£ã€‘</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">first_sentence</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sequence&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;updated&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.update(first_vector_id, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">new_metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_metadata)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æŒ‰IDæŸ¥è¯¢æ›´æ–°ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    updated_res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.get_by_id(first_vector_id)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æ›´æ–°åçš„æ•°æ®ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">updated_res[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sentence&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 10. æµ‹è¯•æ•°æ®åˆ é™¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.delete(first_vector_id)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">åˆ é™¤åæ•°æ®åº“å‘é‡æ€»æ•°ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(db.vectors)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 11. ä»æœ¬åœ°åŠ è½½æ•°æ®åº“éªŒè¯æŒä¹…åŒ–åŠŸèƒ½</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=== ä»æœ¬åœ°åŠ è½½æ•°æ®åº“ ===&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    loaded_db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SimpleVectorDB.load()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;åŠ è½½çš„æ•°æ®åº“å‘é‡æ€»æ•°ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loaded_db.vectors)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # éªŒè¯åŠ è½½çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> loaded_db.vector_ids:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sample_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> loaded_db.vector_ids[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sample_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> loaded_db.get_by_id(sample_id)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;åŠ è½½æ•°æ®ç¤ºä¾‹ï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sample_data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;metadata&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sentence&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ­£åœ¨åŠ è½½ä¸­æ–‡æ–‡æœ¬åµŒå…¥æ¨¡å‹...</span></span>
<span class="line"><span>No sentence-transformers model found with name ./model/iic/nlp_gte_sentence-embedding_chinese-base. Creating a new one with mean pooling.</span></span>
<span class="line"><span>æˆåŠŸåŠ è½½æœ¬åœ°æ¨¡å‹ï¼š./model/iic/nlp_gte_sentence-embedding_chinese-base</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ­£åœ¨è¯»å–å¹¶å¤„ç†txtæ–‡ä»¶ï¼š./data/Datawhaleç¤¾åŒºä»‹ç»å¤§æ¨¡å‹æ”¹å†™ç‰ˆ.txt</span></span>
<span class="line"><span>æˆåŠŸè¯»å–txtæ–‡ä»¶ï¼Œå…±åˆ‡åˆ†å‡º 68 ä¸ªå¥å­</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ­£åœ¨å°†å¥å­è½¬å‘é‡å¹¶æ’å…¥æ•°æ®åº“...</span></span>
<span class="line"><span>æ•°æ®åº“å·²ä¿å­˜è‡³vector_db.pkl</span></span>
<span class="line"><span></span></span>
<span class="line"><span>=== æš´åŠ›æ£€ç´¢ç»“æœï¼ˆæŸ¥è¯¢ï¼š&#39;Datawhaleæœ‰å¤šä¸ªå­¦ä¹ è€…å‚ä¸æ´»åŠ¨&#39;ï¼‰===</span></span>
<span class="line"><span>ç›¸ä¼¼åº¦ï¼š0.9302 | å¥å­ï¼š</span></span>
<span class="line"><span>Datawhale ç›®å‰æœ‰è¶…è¿‡å…­ä¸‡åæ ¸å¿ƒå­¦ä¹ è€…å’Œå¿—æ„¿è€…å‚ä¸ç¤¾åŒºæ´»åŠ¨</span></span>
<span class="line"><span>ç›¸ä¼¼åº¦ï¼š0.9168 | å¥å­ï¼š</span></span>
<span class="line"><span>Datawhale å°†å­¦ä¹ è€…ç»„ç»‡æˆä¸åŒå…´è¶£æ–¹å‘çš„å°ç»„</span></span>
<span class="line"><span>ç›¸ä¼¼åº¦ï¼š0.9065 | å¥å­ï¼š</span></span>
<span class="line"><span>Datawhale é€šè¿‡åä½œæœºåˆ¶å¸å¼•å¤§é‡å¿—æ„¿è€…å‚ä¸å­¦ä¹ å†…å®¹çš„å…±å»º</span></span>
<span class="line"><span></span></span>
<span class="line"><span>=== IVFè¿‘ä¼¼æ£€ç´¢ç»“æœï¼ˆæŸ¥è¯¢ï¼š&#39;Datawhaleæœ‰å¤šä¸ªå­¦ä¹ è€…å‚ä¸æ´»åŠ¨&#39;ï¼‰===</span></span>
<span class="line"><span>ç›¸ä¼¼åº¦ï¼š0.9302 | èšç±»IDï¼š7 | å¥å­ï¼š</span></span>
<span class="line"><span>Datawhale ç›®å‰æœ‰è¶…è¿‡å…­ä¸‡åæ ¸å¿ƒå­¦ä¹ è€…å’Œå¿—æ„¿è€…å‚ä¸ç¤¾åŒºæ´»åŠ¨</span></span>
<span class="line"><span>ç›¸ä¼¼åº¦ï¼š0.9017 | èšç±»IDï¼š7 | å¥å­ï¼š</span></span>
<span class="line"><span>Datawhale æ¯å¹´ä¸¾è¡Œè¶…è¿‡äºŒååœºæŠ€æœ¯ä¸»é¢˜åˆ†äº«</span></span>
<span class="line"><span>ç›¸ä¼¼åº¦ï¼š0.8981 | èšç±»IDï¼š7 | å¥å­ï¼š</span></span>
<span class="line"><span>Datawhale æ¯å¹´ä¸¾åŠåæ¬¡ä»¥ä¸Š AI ç¤¾åŒºæ´»åŠ¨</span></span>
<span class="line"><span></span></span>
<span class="line"><span>=== æ•°æ®æ›´æ–°ä¸æŸ¥è¯¢æµ‹è¯• ===</span></span>
<span class="line"><span>å¾…æ›´æ–°çš„åŸå§‹å¥å­ï¼šDatawhale æ˜¯ä¸€ä¸ªå¼€æºã€å¼€æ”¾ã€å…¬ç›Šçš„å­¦ä¹ å‹ç»„ç»‡</span></span>
<span class="line"><span>æ›´æ–°åçš„æ•°æ®ï¼šã€ä¿®æ­£ã€‘Datawhale æ˜¯ä¸€ä¸ªå¼€æºã€å¼€æ”¾ã€å…¬ç›Šçš„å­¦ä¹ å‹ç»„ç»‡</span></span>
<span class="line"><span></span></span>
<span class="line"><span>åˆ é™¤åæ•°æ®åº“å‘é‡æ€»æ•°ï¼š67</span></span>
<span class="line"><span></span></span>
<span class="line"><span>=== ä»æœ¬åœ°åŠ è½½æ•°æ®åº“ ===</span></span>
<span class="line"><span>å·²ä»vector_db.pklåŠ è½½æ•°æ®åº“ï¼Œå…±åŒ…å«68ä¸ªå‘é‡</span></span>
<span class="line"><span>åŠ è½½çš„æ•°æ®åº“å‘é‡æ€»æ•°ï¼š68</span></span>
<span class="line"><span>åŠ è½½æ•°æ®ç¤ºä¾‹ï¼šDatawhale æ˜¯ä¸€ä¸ªå¼€æºã€å¼€æ”¾ã€å…¬ç›Šçš„å­¦ä¹ å‹ç»„ç»‡</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="_4-ç»“æœåˆ†æä¸æ‰©å±•æ–¹å‘" tabindex="-1">4.ç»“æœåˆ†æä¸æ‰©å±•æ–¹å‘ <a class="header-anchor" href="#_4-ç»“æœåˆ†æä¸æ‰©å±•æ–¹å‘" aria-label="Permalink to &quot;4.ç»“æœåˆ†æä¸æ‰©å±•æ–¹å‘&quot;">â€‹</a></h2><h3 id="_4-1-æ ¸å¿ƒåŠŸèƒ½éªŒè¯" tabindex="-1">4.1 æ ¸å¿ƒåŠŸèƒ½éªŒè¯ <a class="header-anchor" href="#_4-1-æ ¸å¿ƒåŠŸèƒ½éªŒè¯" aria-label="Permalink to &quot;4.1 æ ¸å¿ƒåŠŸèƒ½éªŒè¯&quot;">â€‹</a></h3><p>è¿è¡Œä¸Šè¿°ä»£ç åï¼Œä½ å°†è§‚å¯Ÿåˆ°ï¼š</p><ol><li>æš´åŠ›æ£€ç´¢èƒ½ç²¾å‡†è¿”å›ä¸æŸ¥è¯¢æ–‡æœ¬è¯­ä¹‰æœ€ç›¸å…³çš„ç»“æœï¼ˆç›¸ä¼¼åº¦æœ€é«˜ï¼‰ï¼›</li><li>IVFæ£€ç´¢ç»“æœä¸æš´åŠ›æ£€ç´¢æ¥è¿‘ï¼Œä½†é€Ÿåº¦æ›´å¿«ï¼ˆå°¤å…¶å½“å‘é‡æ•°é‡åºå¤§æ—¶ï¼Œä¼˜åŠ¿æ›´æ˜æ˜¾ï¼‰ï¼›</li><li>å¢åˆ æ”¹æŸ¥åŠæŒä¹…åŒ–åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œæ•°æ®å¯è·¨ç¨‹åºä¼šè¯ä¿ç•™ã€‚</li></ol><h3 id="_4-2-ä¸å·¥ä¸šçº§å‘é‡æ•°æ®åº“çš„å·®è·" tabindex="-1">4.2 ä¸å·¥ä¸šçº§å‘é‡æ•°æ®åº“çš„å·®è· <a class="header-anchor" href="#_4-2-ä¸å·¥ä¸šçº§å‘é‡æ•°æ®åº“çš„å·®è·" aria-label="Permalink to &quot;4.2 ä¸å·¥ä¸šçº§å‘é‡æ•°æ®åº“çš„å·®è·&quot;">â€‹</a></h3><p>æˆ‘ä»¬çš„ç®€åŒ–ç‰ˆå®ç°ä»…åŒ…å«æ ¸å¿ƒé€»è¾‘ï¼Œå·¥ä¸šçº§å‘é‡æ•°æ®åº“ï¼ˆå¦‚Milvusã€Pineconeï¼‰è¿˜å…·å¤‡ä»¥ä¸‹é«˜çº§ç‰¹æ€§ï¼š</p><ul><li>åˆ†å¸ƒå¼å­˜å‚¨ä¸å¹¶è¡Œè®¡ç®—ï¼ˆæ”¯æŒäº¿çº§å‘é‡ï¼‰ï¼›</li><li>æ›´å¤šç´¢å¼•ç®—æ³•ï¼ˆå¦‚HNSWã€PQçš„ä¼˜åŒ–å®ç°ï¼‰ï¼›</li><li>å‘é‡ä¸ç»“æ„åŒ–æ•°æ®çš„æ··åˆæŸ¥è¯¢ï¼›</li><li>é«˜å¯ç”¨ä¸å®¹é”™æœºåˆ¶ï¼ˆå‰¯æœ¬ã€å¤‡ä»½ï¼‰ï¼›</li><li>RESTful APIæˆ–SDKå°è£…ï¼ˆä¾¿äºå¤šè¯­è¨€è°ƒç”¨ï¼‰ã€‚</li></ul><h3 id="_4-3-æ‰©å±•æ–¹å‘-è¯¾åç»ƒä¹ " tabindex="-1">4.3 æ‰©å±•æ–¹å‘ï¼ˆè¯¾åç»ƒä¹ ï¼‰ <a class="header-anchor" href="#_4-3-æ‰©å±•æ–¹å‘-è¯¾åç»ƒä¹ " aria-label="Permalink to &quot;4.3 æ‰©å±•æ–¹å‘ï¼ˆè¯¾åç»ƒä¹ ï¼‰&quot;">â€‹</a></h3><p>åŸºäºæœ¬å®ç°ï¼Œä½ å¯ä»¥å°è¯•æ‰©å±•ä»¥ä¸‹åŠŸèƒ½ï¼Œæ·±åŒ–ç†è§£ï¼š</p><ol><li>å®ç°HNSWç´¢å¼•ï¼ˆå‚è€ƒChapter 5çš„HNSWç®—æ³•åŸç†ï¼Œç”¨å›¾ç»“æ„å­˜å‚¨å‘é‡é‚»å±…å…³ç³»ï¼‰ï¼›</li><li>æ·»åŠ å‘é‡ç»´åº¦å‹ç¼©åŠŸèƒ½ï¼ˆåŸºäºPQç®—æ³•ï¼Œå‡å°‘å­˜å‚¨å¼€é”€ï¼‰ï¼›</li><li>å®ç°æ‰¹é‡æ’å…¥/æ‰¹é‡æ£€ç´¢æ¥å£ï¼ˆæå‡æ•°æ®æ“ä½œæ•ˆç‡ï¼‰ï¼›</li><li>å¢åŠ å‘é‡è¿‡æ»¤åŠŸèƒ½ï¼ˆå¦‚æŒ‰å…ƒæ•°æ®ä¸­çš„å…³é”®è¯ç­›é€‰åå†æ£€ç´¢ï¼‰ã€‚</li></ol><h2 id="_5-æ€»ç»“" tabindex="-1">5.æ€»ç»“ <a class="header-anchor" href="#_5-æ€»ç»“" aria-label="Permalink to &quot;5.æ€»ç»“&quot;">â€‹</a></h2><p>æœ¬ç« é€šè¿‡Pythonæ‰‹åŠ¨å®ç°å‘é‡æ•°æ®åº“ï¼Œå°†å‰åºç« èŠ‚çš„ç†è®ºçŸ¥è¯†ï¼ˆå¦‚å‘é‡ç›¸ä¼¼åº¦ã€IVFç´¢å¼•ï¼‰è½åœ°ä¸ºå¯è¿è¡Œçš„ä»£ç ã€‚æ ¸å¿ƒæ”¶è·åŒ…æ‹¬ï¼š</p><ul><li>ç†è§£å‘é‡æ•°æ®åº“â€œå­˜å‚¨-ç´¢å¼•-æ£€ç´¢â€çš„æ ¸å¿ƒæµç¨‹ï¼›</li><li>æŒæ¡ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—ã€IVFç´¢å¼•æ„å»ºçš„å®é™…ä»£ç å®ç°ï¼›</li><li>æ˜ç¡®ç®€åŒ–ç‰ˆä¸å·¥ä¸šçº§å®ç°çš„å·®å¼‚ï¼Œä¸ºåç»­å­¦ä¹ å¥ å®šåŸºç¡€ã€‚</li></ul><p>æ­å–œï¼ä½ å·²ç»æˆåŠŸå®Œæˆæœ¬ç« çš„å®è·µï¼Œå¹¶æˆåŠŸå®ç°äº†ä¸€ä¸ªå‘é‡æ•°æ®åº“ã€‚</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/datawhalechina/easy-vecdb/edit/main/docs/base/chapter6/å®ç°ä½ è‡ªå·±çš„å‘é‡æ•°æ®åº“.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>æœ€åæ›´æ–°äº: <time datetime="2025-11-25T08:13:37.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/easy-vecdb/base/chapter5/LSH%E7%AE%97%E6%B3%95.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>LSHç®—æ³•</span><!--]--></a></div><div class="pager" data-v-e257564d><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>åŸºäº Apache-2.0 è®¸å¯å‘å¸ƒ</p><p class="copyright" data-v-e315a0ad><a href="https://beian.miit.gov.cn/" target="_blank">äº¬ICPå¤‡2026002630å·-1</a> | <a href="https://beian.mps.gov.cn/#/query/webSearch?code=11010602202215" rel="noreferrer" target="_blank">äº¬å…¬ç½‘å®‰å¤‡11010602202215å·</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"annoy_chapter1_annoyå…¥é—¨ä¸ç¯å¢ƒæ­å»º.md\":\"C86TB_kz\",\"annoy_chapter2_annoyæ ¸å¿ƒapiè¯¦è§£.md\":\"BdxKLN3m\",\"annoy_chapter3_annoyè¿›é˜¶æŠ€å·§ä¸æœ€ä½³å®è·µ.md\":\"EADTfvty\",\"base_chapter1_å­¦ä¹ è·¯å¾„æ¨è.md\":\"Daij0OP6\",\"base_chapter1_é¡¹ç›®ä»‹ç».md\":\"igi-N8LW\",\"base_chapter2_ä¸ºä»€ä¹ˆéœ€è¦å‘é‡æ•°æ®åº“.md\":\"DOOY35CH\",\"base_chapter3_å‘é‡åµŒå…¥ç®—æ³•åŸºç¡€.md\":\"BAVj6Rxq\",\"base_chapter4_å‘é‡æœç´¢ç®—æ³•åŸºç¡€.md\":\"C2zPg0SL\",\"base_chapter5_annoyç®—æ³•.md\":\"B7hd0TSm\",\"base_chapter5_annæœç´¢ç®—æ³•.md\":\"BVGDWXXe\",\"base_chapter5_hnswç®—æ³•.md\":\"BFcShGAu\",\"base_chapter5_ivfç®—æ³•.md\":\"Z4APPMk4\",\"base_chapter5_lshç®—æ³•.md\":\"CEiBi1_C\",\"base_chapter5_pqç®—æ³•.md\":\"D6LTdySi\",\"base_chapter6_å®ç°ä½ è‡ªå·±çš„å‘é‡æ•°æ®åº“.md\":\"Bby1XfT-\",\"faiss_chapter1_faisså…¥é—¨ä¸ç¯å¢ƒæ­å»º.md\":\"B1102qHm\",\"faiss_chapter2_faissæ•°æ®ç»“æ„ä¸ç´¢å¼•.md\":\"wNHEvArG\",\"faiss_chapter3_faissæ ¸å¿ƒåŠŸèƒ½è¿›é˜¶.md\":\"CWHKzKDF\",\"faiss_chapter4_faissæ€§èƒ½è°ƒä¼˜ä¸è¯„ä¼°.md\":\"BESwZH_r\",\"faiss_chapter5_faisså·¥ç¨‹åŒ–è½åœ°å®æˆ˜.md\":\"C-14T22S\",\"index.md\":\"DNVwDjEp\",\"milvus_chapter1_milvuså‘é‡æ•°æ®åº“å…¥é—¨.md\":\"C6XYXgjy\",\"milvus_chapter2_milvusæ ¸å¿ƒæ¦‚å¿µ.md\":\"hKoqcOt6\",\"milvus_chapter3_pymilvusæ ¸å¿ƒapiå®æˆ˜.md\":\"8zR9WrqF\",\"milvus_chapter4_milvusçš„aiåº”ç”¨å¼€å‘.md\":\"DgW_YVAK\",\"milvus_chapter5_milvusçš„aiåº”ç”¨å¼€å‘.md\":\"OR-95EMj\",\"milvus_chapter6_milvus liteéƒ¨ç½²ä¸åº”ç”¨.md\":\"JFtQ48mt\",\"milvus_chapter6_milvus rerankeré‡æ’.md\":\"CFE_KuVK\",\"milvus_chapter6_milvus å­˜å‚¨ä¼˜åŒ–.md\":\"is0KMx8t\",\"milvus_chapter6_milvusåº•å±‚æ¶æ„è¯¦è§£.md\":\"C9WAQVcm\",\"milvus_chapter6_mineruéƒ¨ç½²æ•™ç¨‹.md\":\"D5H6QSLi\",\"more_chapter1_gpuåŠ é€Ÿæ£€ç´¢-åŸºäºfusionanns.md\":\"CfIev-Kt\",\"more_chapter2_meta-chunkingï¼šä¸€ç§æ–°çš„æ–‡æœ¬åˆ‡åˆ†ç­–ç•¥.md\":\"BS871zQ0\",\"more_chapter3_limitåŸºäºåµŒå…¥æ£€ç´¢çš„ç†è®ºæé™.md\":\"8lcgKgwB\",\"more_chapter3_meta_limit_code_startup.md\":\"Cn416tJt\",\"more_chapter4_rabitqï¼šç”¨äºè¿‘ä¼¼æœ€è¿‘é‚»æœç´¢çš„å¸¦ç†è®ºè¯¯å·®ç•Œçš„é«˜ç»´å‘é‡é‡åŒ–.md\":\"BTFBP4ot\",\"more_chapter5_å‘é‡.md\":\"2Fx0juom\",\"more_chapter6_k-meanç®—æ³•è¯¦è§£.md\":\"BTJ9_1pl\",\"more_chapter6_èšç±»ç®—æ³•ä»‹ç».md\":\"BrVmwXc5\",\"more_milvus æ•°æ®åˆ‡åˆ†æ€»ç»“.md\":\"Bgy33nqW\",\"projects_index.md\":\"0ENSoYyC\",\"projects_project1_readme.md\":\"DevbXIn7\",\"projects_project2_readme.md\":\"_QUWrFZ8\",\"projects_project3_readme.md\":\"CAmd7TaH\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"EasyVecDB æ•™ç¨‹\",\"description\":\"å‘é‡æ•°æ®åº“å­¦ä¹ ä¸å®æˆ˜æŒ‡å—\",\"base\":\"/easy-vecdb/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"returnToTopLabel\":\"è¿”å›é¡¶éƒ¨\",\"logo\":\"/favicon.ico\",\"outline\":{\"level\":[1,4]},\"nav\":[{\"text\":\"é¦–é¡µ\",\"link\":\"/\"},{\"text\":\"å‘é‡åŸºç¡€\",\"link\":\"/base/chapter1/é¡¹ç›®ä»‹ç»\"},{\"text\":\"Annoy æ•™ç¨‹\",\"link\":\"/Annoy/chapter1/Annoyå…¥é—¨ä¸ç¯å¢ƒæ­å»º\"},{\"text\":\"Faiss æ•™ç¨‹\",\"link\":\"/Faiss/chapter1/FAISSå…¥é—¨ä¸ç¯å¢ƒæ­å»º\"},{\"text\":\"Milvus æ•™ç¨‹\",\"link\":\"/Milvus/chapter1/Milvuså‘é‡æ•°æ®åº“å…¥é—¨\"},{\"text\":\"è¡¥å……å†…å®¹\",\"link\":\"/more/chapter5/å‘é‡\"},{\"text\":\"å®æˆ˜é¡¹ç›®\",\"link\":\"/projects/\"}],\"sidebar\":{\"/base/\":[{\"text\":\"Chapter 1 Â· é¡¹ç›®ä»‹ç»\",\"items\":[{\"text\":\"é¡¹ç›®ä»‹ç»\",\"link\":\"/base/chapter1/é¡¹ç›®ä»‹ç»\"},{\"text\":\"å­¦ä¹ è·¯å¾„æ¨è\",\"link\":\"/base/chapter1/å­¦ä¹ è·¯å¾„æ¨è\"}]},{\"text\":\"Chapter 2 Â· å‘é‡æ•°æ®åº“æ¦‚å¿µ\",\"items\":[{\"text\":\"ä¸ºä»€ä¹ˆéœ€è¦å‘é‡æ•°æ®åº“\",\"link\":\"/base/chapter2/ä¸ºä»€ä¹ˆéœ€è¦å‘é‡æ•°æ®åº“\"}]},{\"text\":\"Chapter 3 Â· å‘é‡åµŒå…¥ç®—æ³•åŸºç¡€\",\"items\":[{\"text\":\"å‘é‡åµŒå…¥ç®—æ³•åŸºç¡€\",\"link\":\"/base/chapter3/å‘é‡åµŒå…¥ç®—æ³•åŸºç¡€\"}]},{\"text\":\"Chapter 4 Â· å‘é‡æœç´¢ç®—æ³•åŸºç¡€\",\"items\":[{\"text\":\"å‘é‡æœç´¢ç®—æ³•åŸºç¡€\",\"link\":\"/base/chapter4/å‘é‡æœç´¢ç®—æ³•åŸºç¡€\"}]},{\"text\":\"Chapter 5 Â· å‘é‡ANNæœç´¢ç®—æ³•\",\"items\":[{\"text\":\"ANNæœç´¢ç®—æ³•\",\"link\":\"/base/chapter5/ANNæœç´¢ç®—æ³•\"},{\"text\":\"Annoyç®—æ³•\",\"link\":\"/base/chapter5/Annoyç®—æ³•\"},{\"text\":\"IVFç®—æ³•\",\"link\":\"/base/chapter5/IVFç®—æ³•\"},{\"text\":\"HNSWç®—æ³•\",\"link\":\"/base/chapter5/HNSWç®—æ³•\"},{\"text\":\"PQç®—æ³•\",\"link\":\"/base/chapter5/PQç®—æ³•\"},{\"text\":\"LSHç®—æ³•\",\"link\":\"/base/chapter5/LSHç®—æ³•\"}]},{\"text\":\"Chapter 6 Â· å®ç°ä½ è‡ªå·±çš„å‘é‡æ•°æ®åº“\",\"items\":[{\"text\":\"å®ç°ä½ è‡ªå·±çš„å‘é‡æ•°æ®åº“\",\"link\":\"/base/chapter6/å®ç°ä½ è‡ªå·±çš„å‘é‡æ•°æ®åº“\"}]}],\"/Annoy/\":[{\"text\":\"Chapter 1 Â· Annoyå…¥é—¨ä¸ç¯å¢ƒæ­å»º\",\"items\":[{\"text\":\"Annoyå…¥é—¨ä¸ç¯å¢ƒæ­å»º\",\"link\":\"/Annoy/chapter1/Annoyå…¥é—¨ä¸ç¯å¢ƒæ­å»º\"}]},{\"text\":\"Chapter 2 Â· Annoyæ ¸å¿ƒAPIè¯¦è§£\",\"items\":[{\"text\":\"Annoyæ ¸å¿ƒAPIè¯¦è§£\",\"link\":\"/Annoy/chapter2/Annoyæ ¸å¿ƒAPIè¯¦è§£\"}]},{\"text\":\"Chapter 3 Â· Annoyè¿›é˜¶æŠ€å·§ä¸æœ€ä½³å®è·µ\",\"items\":[{\"text\":\"Annoyè¿›é˜¶æŠ€å·§ä¸æœ€ä½³å®è·µ\",\"link\":\"/Annoy/chapter3/Annoyè¿›é˜¶æŠ€å·§ä¸æœ€ä½³å®è·µ\"}]}],\"/Faiss/\":[{\"text\":\"Chapter 1 Â· FAISSå…¥é—¨ä¸ç¯å¢ƒæ­å»º\",\"items\":[{\"text\":\"FAISS å…¥é—¨ä¸ç¯å¢ƒæ­å»º\",\"link\":\"/Faiss/chapter1/FAISSå…¥é—¨ä¸ç¯å¢ƒæ­å»º\"}]},{\"text\":\"Chapter 2 Â· FAISSæ•°æ®ç»“æ„ä¸ç´¢å¼•ç±»å‹\",\"items\":[{\"text\":\"FAISSæ•°æ®ç»“æ„ä¸ç´¢å¼•ç±»å‹\",\"link\":\"/Faiss/chapter2/FAISSæ•°æ®ç»“æ„ä¸ç´¢å¼•\"}]},{\"text\":\"Chapter 3 Â· FAISSæ ¸å¿ƒåŠŸèƒ½è¿›é˜¶\",\"items\":[{\"text\":\"FAISSæ ¸å¿ƒåŠŸèƒ½è¿›é˜¶\",\"link\":\"/Faiss/chapter3/FAISSæ ¸å¿ƒåŠŸèƒ½è¿›é˜¶\"}]},{\"text\":\"Chapter 4 Â· FAISSæ€§èƒ½è°ƒä¼˜ä¸è¯„ä¼°\",\"items\":[{\"text\":\"FAISSæ€§èƒ½è°ƒä¼˜ä¸è¯„ä¼°\",\"link\":\"/Faiss/chapter4/FAISSæ€§èƒ½è°ƒä¼˜ä¸è¯„ä¼°\"}]},{\"text\":\"Chapter 5 Â· FAISSå·¥ç¨‹åŒ–è½åœ°å®æˆ˜\",\"items\":[{\"text\":\"FAISSå·¥ç¨‹åŒ–è½åœ°å®æˆ˜\",\"link\":\"/Faiss/chapter5/FAISSå·¥ç¨‹åŒ–è½åœ°å®æˆ˜\"}]}],\"/Milvus/\":[{\"text\":\"Chapter 1 Â· Milvuså‘é‡æ•°æ®åº“å…¥é—¨\",\"items\":[{\"text\":\"Milvuså‘é‡æ•°æ®åº“å…¥é—¨\",\"link\":\"/Milvus/chapter1/Milvuså‘é‡æ•°æ®åº“å…¥é—¨\"}]},{\"text\":\"Chapter 2 Â· Milvusæ ¸å¿ƒæ¦‚å¿µ\",\"items\":[{\"text\":\"Milvusæ ¸å¿ƒæ¦‚å¿µ\",\"link\":\"/Milvus/chapter2/Milvusæ ¸å¿ƒæ¦‚å¿µ\"}]},{\"text\":\"Chapter 3 Â· MilvusåŸºç¡€æ“ä½œ\",\"items\":[{\"text\":\"MilvusåŸºç¡€æ“ä½œ\",\"link\":\"/Milvus/chapter3/PyMilvusæ ¸å¿ƒAPIå®æˆ˜\"}]},{\"text\":\"Chapter 4 Â· Milvusçš„AIåº”ç”¨å¼€å‘\",\"items\":[{\"text\":\"ç»¼åˆå®æˆ˜:åŸºäºBM25çš„æ··åˆæœç´¢å‘é‡æ•°æ®åº“å¼€å‘å®æˆ˜\",\"link\":\"/Milvus/chapter4/Milvusçš„AIåº”ç”¨å¼€å‘\"}]},{\"text\":\"Chapter 5 Â· Milvusçš„AIåº”ç”¨å¼€å‘\",\"items\":[{\"text\":\"ç»¼åˆå®æˆ˜:å›¾åƒæ£€ç´¢åº”ç”¨å®æˆ˜\",\"link\":\"/Milvus/chapter5/Milvusçš„AIåº”ç”¨å¼€å‘\"}]},{\"text\":\"Chapter 6 Â· Milvusé€‰å­¦éƒ¨åˆ†\",\"items\":[{\"text\":\"Milvusåº•å±‚æ¶æ„è¯¦è§£\",\"link\":\"/Milvus/chapter6/Milvusåº•å±‚æ¶æ„è¯¦è§£\"},{\"text\":\"Milvus Reranker\",\"link\":\"/Milvus/chapter6/Milvus Rerankeré‡æ’\"},{\"text\":\"Milvus Liteéƒ¨ç½²æ•™ç¨‹\",\"link\":\"/Milvus/chapter6/Milvus Liteéƒ¨ç½²ä¸åº”ç”¨\"},{\"text\":\"MinerU éƒ¨ç½²æ•™ç¨‹\",\"link\":\"/Milvus/chapter5/MinerUéƒ¨ç½²æ•™ç¨‹\"}]}],\"/more/\":[{\"text\":\"Chapter 1 Â· FusionANNS\",\"items\":[{\"text\":\"FusionANNSæ¶æ„è®¾è®¡\",\"link\":\"/more/chapter1/GPUåŠ é€Ÿæ£€ç´¢-åŸºäºFusionANNS\"}]},{\"text\":\"Chapter 2 Â· Meta-Chunking\",\"items\":[{\"text\":\"å…¨æ–°çš„æ–‡æœ¬åˆ‡åˆ†ç­–ç•¥\",\"link\":\"/more/chapter2/Meta-Chunkingï¼šä¸€ç§æ–°çš„æ–‡æœ¬åˆ‡åˆ†ç­–ç•¥\"}]},{\"text\":\"Chapter 3 Â· Limit\",\"items\":[{\"text\":\"åŸºäºåµŒå…¥æ£€ç´¢çš„ç†è®ºæé™\",\"link\":\"/more/chapter3/LimitåŸºäºåµŒå…¥æ£€ç´¢çš„ç†è®ºæé™\"},{\"text\":\"å®è·µæ“ä½œ\",\"link\":\"/more/chapter3/Meta_limit/code/startup\"}]},{\"text\":\"Chapter 4 Â· RabitQ\",\"items\":[{\"text\":\"RabitQç´¢å¼•\",\"link\":\"/more/chapter4/RabitQï¼šç”¨äºè¿‘ä¼¼æœ€è¿‘é‚»æœç´¢çš„å¸¦ç†è®ºè¯¯å·®ç•Œçš„é«˜ç»´å‘é‡é‡åŒ–\"}]},{\"text\":\"Chapter 5 Â· ç¨€ç–ã€ç¨ å¯†å‘é‡\",\"items\":[{\"text\":\"å‘é‡åŸºç¡€çŸ¥è¯†\",\"link\":\"/more/chapter5/å‘é‡\"}]},{\"text\":\"Chapter 6 Â· èšç±»ç®—æ³•\",\"items\":[{\"text\":\"ä¸¤ç§èšç±»ç®—æ³•\",\"link\":\"/more/chapter6/èšç±»ç®—æ³•ä»‹ç»\"},{\"text\":\"K-meansèšç±»è¯¦è§£\",\"link\":\"/more/chapter6/K-meanç®—æ³•è¯¦è§£\"}]}],\"/projects/\":[{\"text\":\"å®æˆ˜é¡¹ç›®1\",\"items\":[{\"text\":\"åŸºäºFAISSæ¡†æ¶RAGå®æˆ˜é¡¹ç›®\",\"link\":\"/projects/project1/README\"}]},{\"text\":\"å®æˆ˜é¡¹ç›®2\",\"items\":[{\"text\":\"åŸºäºMilvusæ¡†æ¶çš„Agenté¡¹ç›®\",\"link\":\"/projects/project2/README\"}]},{\"text\":\"å®æˆ˜é¡¹ç›®3\",\"items\":[{\"text\":\"åŸºäºMilvuså’ŒArangoDBçš„RAGç³»ç»Ÿ\",\"link\":\"/projects/project3/README\"}]},{\"text\":\"å®æˆ˜æ¦‚è§ˆ\",\"items\":[{\"text\":\"é¡¹ç›®æ¦‚è§ˆ\",\"link\":\"/projects/\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/datawhalechina/easy-vecdb\"}],\"search\":{\"provider\":\"local\"},\"editLink\":{\"pattern\":\"https://github.com/datawhalechina/easy-vecdb/edit/main/docs/:path\",\"text\":\"åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ\"},\"lastUpdated\":{\"text\":\"æœ€åæ›´æ–°äº\",\"formatOptions\":{\"dateStyle\":\"short\",\"timeStyle\":\"medium\"}},\"footer\":{\"message\":\"åŸºäº Apache-2.0 è®¸å¯å‘å¸ƒ\",\"copyright\":\"<a href=\\\"https://beian.miit.gov.cn/\\\" target=\\\"_blank\\\">äº¬ICPå¤‡2026002630å·-1</a> | <a href=\\\"https://beian.mps.gov.cn/#/query/webSearch?code=11010602202215\\\" rel=\\\"noreferrer\\\" target=\\\"_blank\\\">äº¬å…¬ç½‘å®‰å¤‡11010602202215å·</a>\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>