import{_ as i,o as a,c as n,ag as l}from"./chunks/framework.CzE6cJJL.js";const g=JSON.parse('{"title":"Chapter 1：FAISS 入门与环境搭建","description":"","frontmatter":{},"headers":[],"relativePath":"Faiss/chapter1/FAISS入门与环境搭建.md","filePath":"Faiss/chapter1/FAISS入门与环境搭建.md","lastUpdated":1768549133000}'),t={name:"Faiss/chapter1/FAISS入门与环境搭建.md"};function p(e,s,h,k,r,d){return a(),n("div",null,[...s[0]||(s[0]=[l(`<h1 id="chapter-1-faiss-入门与环境搭建" tabindex="-1">Chapter 1：FAISS 入门与环境搭建 <a class="header-anchor" href="#chapter-1-faiss-入门与环境搭建" aria-label="Permalink to &quot;Chapter 1：FAISS 入门与环境搭建&quot;">​</a></h1><p>本章节将带大家从FAISS的核心认知出发，完成环境搭建，并通过核心数据结构解析与基础示例实践，建立对FAISS的完整入门认知，为后续进阶学习奠定基础。</p><h2 id="_1-faiss-核心定位与生态" tabindex="-1">1 FAISS 核心定位与生态 <a class="header-anchor" href="#_1-faiss-核心定位与生态" aria-label="Permalink to &quot;1 FAISS 核心定位与生态&quot;">​</a></h2><blockquote><p><strong>学习要求</strong>：理解FAISS的核心价值，明确其适用边界</p></blockquote><h3 id="_1-1-faiss的定义、研发背景与核心优势" tabindex="-1">1.1 FAISS的定义、研发背景与核心优势 <a class="header-anchor" href="#_1-1-faiss的定义、研发背景与核心优势" aria-label="Permalink to &quot;1.1 FAISS的定义、研发背景与核心优势&quot;">​</a></h3><p><strong>定义</strong>：FAISS（Facebook AI Similarity Search）是由Meta（原Facebook）AI团队研发的开源向量相似性搜索库，专门用于解决大规模高维向量的快速检索问题，通过高效的算法实现向量之间相似性的计算与匹配，为人工智能应用中的语义检索、图像检索等场景提供底层支撑。</p><p><strong>研发背景</strong>：随着人工智能技术的发展，图像识别、自然语言处理等领域产生了海量的高维向量数据（如图片的特征向量、文本的嵌入向量）。传统的数据库无法高效处理这类数据的相似性检索需求，为解决这一痛点，Meta团队于2017年推出了FAISS，旨在提供一套高效、可扩展的向量检索解决方案。</p><p><strong>核心优势</strong>：</p><ul><li>高效性：针对大规模向量数据（从百万到数十亿级别）优化，提供远超传统方法的检索速度，支持毫秒级响应。</li><li>算法丰富：内置多种检索算法，涵盖精确检索与近似检索，可根据数据规模、精度需求灵活选择。</li><li>硬件适配好：支持CPU与GPU加速，尤其是GPU版本能大幅提升大规模数据的处理能力，充分利用硬件资源。</li><li>易用性：提供简洁的Python与C++ API，便于快速集成到现有AI系统中，降低开发门槛。</li><li>可扩展性：支持向量数据的动态添加与删除（部分索引类型），适配业务数据的增量更新需求。</li></ul><h3 id="_1-2-faiss与milvus-chroma等向量库的对比" tabindex="-1">1.2 FAISS与Milvus/Chroma等向量库的对比 <a class="header-anchor" href="#_1-2-faiss与milvus-chroma等向量库的对比" aria-label="Permalink to &quot;1.2 FAISS与Milvus/Chroma等向量库的对比&quot;">​</a></h3><p>向量数据库的核心差异体现在架构设计、生态完善度、适用场景等方面，以下是FAISS与主流向量库的关键对比：</p><table tabindex="0"><thead><tr><th style="text-align:left;">对比维度</th><th style="text-align:left;">FAISS</th><th style="text-align:left;">Milvus</th><th style="text-align:left;">Chroma</th></tr></thead><tbody><tr><td style="text-align:left;">本质定位</td><td style="text-align:left;">向量检索库（偏算法实现）</td><td style="text-align:left;">企业级向量数据库（完整数据库特性）</td><td style="text-align:left;">轻量级向量数据库（面向开发者快速上手）</td></tr><tr><td style="text-align:left;">核心优势</td><td style="text-align:left;">算法性能强，GPU加速优，适合大规模数据检索</td><td style="text-align:left;">支持分布式部署、高可用、事务，生态完善</td><td style="text-align:left;">安装简单，API极简，适合快速原型开发</td></tr><tr><td style="text-align:left;">部署复杂度</td><td style="text-align:left;">简单（库级调用，无需单独部署服务）</td><td style="text-align:left;">中等（支持单机/分布式，需配置集群）</td><td style="text-align:left;">极简单（单机部署，开箱即用）</td></tr><tr><td style="text-align:left;">适用场景</td><td style="text-align:left;">大规模向量检索任务、算法研究、AI系统底层检索模块</td><td style="text-align:left;">企业级应用、高并发检索服务、数据量激增的业务场景</td><td style="text-align:left;">小规模数据检索、快速开发测试、个人项目</td></tr><tr><td style="text-align:left;">生态集成</td><td style="text-align:left;">需自行集成存储、服务化组件</td><td style="text-align:left;">支持与Spark、Flink、LangChain等主流工具集成</td><td style="text-align:left;">深度适配LangChain，适合LLM应用开发</td></tr></tbody></table><h3 id="_1-3-faiss的适用场景" tabindex="-1">1.3 FAISS的适用场景 <a class="header-anchor" href="#_1-3-faiss的适用场景" aria-label="Permalink to &quot;1.3 FAISS的适用场景&quot;">​</a></h3><p>FAISS的核心能力聚焦于“大规模高维向量的快速相似性检索”，其典型适用场景包括：</p><ul><li><p><strong>大规模向量检索</strong>：当向量数据量达到百万、千万甚至数十亿级别时，FAISS的近似检索算法能在保证一定精度的前提下，实现高效检索。例如：电商平台的商品图片相似推荐（亿级商品图片特征检索）、短视频平台的内容查重（千万级视频特征匹配）。</p></li><li><p><strong>低延迟检索需求</strong>：对检索响应速度要求高的实时应用，如智能客服的语义问答（用户query向量与知识库向量实时匹配，响应时间需控制在100ms内）、自动驾驶中的环境感知（实时检索障碍物特征向量，辅助决策）。</p></li><li><p><strong>AI领域核心支撑</strong>：</p><ul><li><p>计算机视觉（CV）：图像检索、人脸识别（人脸特征向量匹配）、目标跟踪。</p></li><li><p>自然语言处理：语义检索、文本相似度计算、问答系统（知识库向量检索）。</p></li><li><p>多模态检索：跨文本、图像、音频的相似性匹配（如根据文本描述检索相关图片）。</p></li></ul></li></ul><p><strong>算法研究与原型开发</strong>：科研人员可基于FAISS快速验证向量检索算法的效果，开发者可借助其简洁API快速搭建检索模块原型，降低开发成本。</p><p><strong>注意：</strong> FAISS是“向量检索库”而非完整的“数据库”，不具备传统数据库的事务、权限管理等特性，若需企业级高可用服务，需结合Milvus等向量数据库或自行封装服务化组件。</p><h2 id="_2-faiss-环境搭建" tabindex="-1">2 FAISS 环境搭建 <a class="header-anchor" href="#_2-faiss-环境搭建" aria-label="Permalink to &quot;2 FAISS 环境搭建&quot;">​</a></h2><blockquote><p><strong>学习要求</strong>：独立完成本地/实验室服务器的FAISS环境搭建</p></blockquote><p>FAISS支持Python和C++两种开发语言，其中Python版本因其易用性更适合入门学习。</p><p>本小节将详细介绍两种语言的安装方法，重点讲解Python版本的环境搭建（含CPU与GPU支持）。</p><h3 id="_2-1-环境依赖说明" tabindex="-1">2.1 环境依赖说明 <a class="header-anchor" href="#_2-1-环境依赖说明" aria-label="Permalink to &quot;2.1 环境依赖说明&quot;">​</a></h3><p>FAISS的运行依赖基础计算库，核心依赖包括：</p><ul><li><strong>基础依赖</strong>：Python 3.6+（Python版本）、CMake 3.13+（C++源码编译）、GCC 5.4+（编译工具）。</li><li><strong>计算加速依赖</strong>：OpenBLAS：开源线性代数库，用于CPU上的向量计算加速，是FAISS CPU版本的核心依赖。</li><li>CUDA Toolkit：NVIDIA的并行计算架构，用于GPU版本的FAISS加速，需确保显卡支持CUDA（算力≥3.5）。</li></ul><p><strong>Python辅助库</strong>：NumPy（向量数据处理）、Pillow（可选，用于图像特征提取示例）。</p><h3 id="_2-2-python版本安装-推荐" tabindex="-1">2.2 Python版本安装（推荐） <a class="header-anchor" href="#_2-2-python版本安装-推荐" aria-label="Permalink to &quot;2.2 Python版本安装（推荐）&quot;">​</a></h3><p>Python版本的FAISS提供两种安装方式：pip直接安装（简单，适合快速上手）和源码编译安装（灵活，可自定义配置）。</p><h4 id="_2-2-1-pip直接安装" tabindex="-1">2.2.1 pip直接安装 <a class="header-anchor" href="#_2-2-1-pip直接安装" aria-label="Permalink to &quot;2.2.1 pip直接安装&quot;">​</a></h4><p>Meta官方提供了预编译的FAISS pip包，分为CPU版和GPU版，可根据硬件环境选择：</p><ul><li><strong>CPU版本安装</strong>：适用于无NVIDIA GPU的设备，命令如下：</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装CPU版本FAISS </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pip install faiss</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cpu</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><strong>GPU版本安装</strong>：适用于有NVIDIA GPU且已安装CUDA的设备，需根据CUDA版本选择对应包，初学者建议是选择自动适配：</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 确认cuda是否安装</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">C:\\</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">Users\\xiong&gt;nvidia-smi</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">----------------------------------------------------------------------------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NVIDIA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SMI</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 573.24</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                 Driver Version: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">573.24</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         CUDA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Version: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12.8</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">----------------------------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-+</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">------------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">----------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GPU</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Name                  Driver</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Bus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Id          Disp.A </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Volatile Uncorr. </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ECC</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Fan  Temp   Perf          Pwr:Usage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Cap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           Memory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Usage </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GPU</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Util  Compute M. </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">               MIG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> M. </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|=========================================+========================+======================|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  NVIDIA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GeForce </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RTX</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5070</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  WDDM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   00000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Off </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                  N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A   </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">41C</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    P2             </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">10W</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">   90W</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">       0MiB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">   8151MiB</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Default </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        |</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                  N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">----------------------------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-+</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">------------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">----------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">----------------------------------------------------------------------------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Processes:                                                                              </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  GPU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   GI</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   CI</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              PID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   Type   Process name                        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GPU</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Memory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        ID</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                               Usage      </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|=========================================================================================|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  No running processes found                                                             </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">----------------------------------------------------------------------------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-+</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#选择自动适配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pip install faiss</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpu</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>提示：GPU版本的FAISS对CUDA版本有一定兼容性要求，若安装后运行报错，可参考官方文档（<a href="https://github.com/facebookresearch/faiss%EF%BC%89%E6%9F%A5%E8%AF%A2%E5%AF%B9%E5%BA%94FAISS%E7%89%88%E6%9C%AC%E6%94%AF%E6%8C%81%E7%9A%84CUDA%E7%89%88%E6%9C%AC%E3%80%82" target="_blank" rel="noreferrer">https://github.com/facebookresearch/faiss）查询对应FAISS版本支持的CUDA版本。</a></p><h4 id="_2-2-2-源码编译安装-适合自定义需求" tabindex="-1">2.2.2 源码编译安装（适合自定义需求） <a class="header-anchor" href="#_2-2-2-源码编译安装-适合自定义需求" aria-label="Permalink to &quot;2.2.2 源码编译安装（适合自定义需求）&quot;">​</a></h4><p>当需要修改 FAISS 源码或适配特定硬件时，可通过源码编译进行安装。下面以 Linux 系统为例给出完整步骤。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1.安装依赖工具</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build-essential</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cmake</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libopenblas-dev</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2.克隆 FAISS 源码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/facebookresearch/faiss.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> faiss</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 配置编译参数（CPU 版本示例）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建编译目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置 CMake（启用 Python 接口，使用 OpenBLAS）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cmake</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -DFAISS_ENABLE_GPU=OFF</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -DFAISS_ENABLE_PYTHON=ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -DCMAKE_INSTALL_PREFIX=../install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -DPython_EXECUTABLE=$(which </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">python3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ..</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 编译与安装</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编译（-j 后接线程数，可根据 CPU 核心数调整，如 -j8）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装到指定目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将 FAISS 的 Python 模块添加到环境变量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PYTHONPATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PYTHONPATH:../install/python</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># （选）GPU 版本编译（需已安装 CUDA Toolkit）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cmake</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -DFAISS_ENABLE_GPU=ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -DCUDAToolkit_ROOT=/usr/local/cuda</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -DFAISS_ENABLE_PYTHON=ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -DCMAKE_INSTALL_PREFIX=../install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -DPython_EXECUTABLE=$(which </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">python3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ..</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_2-3-c-版本安装" tabindex="-1">2.3 C++版本安装 <a class="header-anchor" href="#_2-3-c-版本安装" aria-label="Permalink to &quot;2.3 C++版本安装&quot;">​</a></h3><p>C++版本的FAISS适合高性能场景开发，安装方式以源码编译为主，本教程以python脚本为主要学习教程，因此有C++需求的请查阅相关资料自行安装。</p><h3 id="_2-4-安装验证与常见问题解决" tabindex="-1">2.4 安装验证与常见问题解决 <a class="header-anchor" href="#_2-4-安装验证与常见问题解决" aria-label="Permalink to &quot;2.4 安装验证与常见问题解决&quot;">​</a></h3><h4 id="_2-4-1-安装验证" tabindex="-1">2.4.1 安装验证 <a class="header-anchor" href="#_2-4-1-安装验证" aria-label="Permalink to &quot;2.4.1 安装验证&quot;">​</a></h4><p>Python版本安装完成后，可通过以下代码验证是否安装成功：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证FAISS版本</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;FAISS版本：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, faiss.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__version__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证向量检索功能</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 生成测试向量（100个128维向量）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dimension </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 128</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 向量维度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">num_vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 向量数量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.random.random((num_vectors, dimension)).astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;float32&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># FAISS默认使用float32类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 创建索引（精确检索）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss.IndexFlatL2(dimension)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># L2距离（欧氏距离）索引</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;索引是否为空：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index.is_trained)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出True表示索引可使用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 添加向量到索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.add(vectors)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;索引中的向量数量：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index.ntotal)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 生成查询向量并检索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query_vector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.random.random((</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dimension)).astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;float32&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 返回Top-5相似结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">distances, indices </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.search(query_vector, k)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. 输出结果</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;查询结果距离（L2）：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, distances)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;查询结果索引：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, indices)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>若代码无报错并输出索引信息、距离和索引结果，则说明FAISS环境搭建成功。</p><h4 id="_2-4-2-常见问题解决" tabindex="-1">2.4.2 常见问题解决 <a class="header-anchor" href="#_2-4-2-常见问题解决" aria-label="Permalink to &quot;2.4.2 常见问题解决&quot;">​</a></h4><ul><li><strong>问题1</strong>：pip安装faiss-gpu时报错“CUDA version mismatch”**原因：安装的faiss-gpu版本与系统CUDA版本不兼容。解决方法：1. 执行<code>nvcc --version</code>查看系统CUDA版本；2. 参考FAISS官方文档选择对应CUDA版本的faiss-gpu包，例如CUDA 11.0对应faiss-gpu==1.7.1；3. 若无需GPU加速，可改用faiss-cpu版本。</li><li><strong>问题2</strong>：运行时提示“libopenblas.so.0: cannot open shared object file”**原因：缺少OpenBLAS依赖库。解决方法：Linux系统执行<code>sudo apt-get install libopenblas-dev</code>；Windows系统可通过Anaconda安装：<code>conda install openblas</code>。</li><li><strong>问题3</strong>：Python导入faiss时提示“ImportError: No module named faiss”**原因：FAISS未正确安装到当前Python环境。解决方法：1. 确认使用的pip命令与Python环境对应（可使用<code>which pip3</code>查看pip路径）；2. 重新使用对应环境的pip安装faiss。</li><li><strong>问题4</strong>：GPU版本FAISS运行时提示“out of memory”**原因：GPU显存不足，无法容纳索引数据。解决方法：1. 减少索引中的向量数量或降低向量维度；2. 使用支持显存优化的索引类型（如IndexIVFFlat）；3. 切换到CPU版本运行。</li></ul><h2 id="_3-faiss-核心数据结构" tabindex="-1">3 FAISS 核心数据结构 <a class="header-anchor" href="#_3-faiss-核心数据结构" aria-label="Permalink to &quot;3 FAISS 核心数据结构&quot;">​</a></h2><blockquote><p><strong>学习要求</strong>：掌握FAISS的核心数据载体，理解Index的核心作用</p></blockquote><p>FAISS的核心功能围绕“向量索引”展开，Index（索引）类是FAISS中最核心的数据结构，所有向量的存储、检索操作都依赖于Index类及其派生类。本小节将解析Index类体系的结构，讲解向量存储的基础规则以及ID映射机制。</p><h3 id="_3-1-index类体系-faiss的核心骨架" tabindex="-1">3.1 Index类体系：FAISS的核心骨架 <a class="header-anchor" href="#_3-1-index类体系-faiss的核心骨架" aria-label="Permalink to &quot;3.1 Index类体系：FAISS的核心骨架&quot;">​</a></h3><p>FAISS通过抽象基类Index定义了向量索引的通用接口，再通过派生类实现不同的检索算法（精确检索、近似检索等）。这种设计既保证了接口的统一性，又实现了算法的灵活扩展。</p><h4 id="_3-1-1-基类index的核心作用" tabindex="-1">3.1.1 基类Index的核心作用 <a class="header-anchor" href="#_3-1-1-基类index的核心作用" aria-label="Permalink to &quot;3.1.1 基类Index的核心作用&quot;">​</a></h4><p>基类Index定义了所有向量索引都必须实现的核心方法，这些方法构成了FAISS的基础API，主要包括：</p><ul><li><strong>add(x)</strong>：将向量数据x添加到索引中，x的形状为（num_vectors, dimension），数据类型需为float32（FAISS的标准数据类型）。</li><li><strong>search(x, k)</strong>：在索引中检索与x最相似的k个向量，返回距离数组（distances）和索引数组（indices）。</li><li><strong>reset()</strong>：清空索引中的所有向量数据，重置索引状态。</li><li><strong>save(filename)/load(filename)</strong>：将索引保存到磁盘或从磁盘加载索引，便于持久化存储。</li><li><strong>is_trained</strong>：属性，返回布尔值，表示索引是否已“训练”完成（部分近似索引需先训练才能使用）。</li><li><strong>ntotal</strong>：属性，返回索引中存储的向量总数。</li></ul><p>基类Index本身是抽象类，无法直接实例化，必须使用其派生类（如IndexFlatL2、IndexIVFFlat等）创建具体的索引对象。</p><h4 id="_3-1-2-常见派生类及其特点" tabindex="-1">3.1.2 常见派生类及其特点 <a class="header-anchor" href="#_3-1-2-常见派生类及其特点" aria-label="Permalink to &quot;3.1.2 常见派生类及其特点&quot;">​</a></h4><p>FAISS提供了数十种Index派生类，根据检索精度可分为“精确检索索引”和“近似检索索引”两大类，以下是入门阶段常用的几种：</p><table tabindex="0"><thead><tr><th style="text-align:left;">索引类型</th><th style="text-align:left;">检索类型</th><th style="text-align:left;">核心特点</th><th style="text-align:left;">适用场景</th></tr></thead><tbody><tr><td style="text-align:left;">IndexFlatL2</td><td style="text-align:left;">精确检索</td><td style="text-align:left;">基于L2（欧氏距离）计算相似度，无近似误差，检索速度较慢，无需训练</td><td style="text-align:left;">小规模数据（万级以下）、对精度要求极高的场景</td></tr><tr><td style="text-align:left;">IndexFlatIP</td><td style="text-align:left;">精确检索</td><td style="text-align:left;">基于内积（Inner Product）计算相似度，适用于归一化向量的余弦相似度检索</td><td style="text-align:left;">文本语义检索（向量已归一化）、特征匹配</td></tr><tr><td style="text-align:left;">IndexIVFFlat</td><td style="text-align:left;">近似检索</td><td style="text-align:left;">基于倒排文件（Inverted File）结构，需先训练聚类中心，检索速度快，精度可调节</td><td style="text-align:left;">中大规模数据（百万级）、平衡速度与精度的场景</td></tr><tr><td style="text-align:left;">IndexIVFPQ</td><td style="text-align:left;">近似检索</td><td style="text-align:left;">在IndexIVF基础上添加乘积量化（PQ）压缩，大幅减少内存占用，支持十亿级数据</td><td style="text-align:left;">超大规模数据（十亿级）、内存有限的场景</td></tr><tr><td style="text-align:left;">IndexHNSWFlat</td><td style="text-align:left;">近似检索</td><td style="text-align:left;">基于层次化近似最近邻（HNSW）算法，检索速度极快，内存占用较高</td><td style="text-align:left;">对检索延迟要求极高的实时场景</td></tr></tbody></table><h3 id="_3-2-向量存储基础-数据格式与维度约束" tabindex="-1">3.2 向量存储基础：数据格式与维度约束 <a class="header-anchor" href="#_3-2-向量存储基础-数据格式与维度约束" aria-label="Permalink to &quot;3.2 向量存储基础：数据格式与维度约束&quot;">​</a></h3><p>FAISS对输入的向量数据有明确的格式和维度要求，这是使用FAISS时容易出错的点，需重点掌握。</p><h4 id="_3-2-1-数据格式要求" tabindex="-1">3.2.1 数据格式要求 <a class="header-anchor" href="#_3-2-1-数据格式要求" aria-label="Permalink to &quot;3.2.1 数据格式要求&quot;">​</a></h4><ul><li><strong>数据类型</strong>：FAISS仅支持32位浮点数（float32）类型的向量，若输入的是Python列表或NumPy的float64数组，需先进行类型转换，否则会报错。</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ❌ 错误示例：默认生成 float64</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vectors_float64 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.random.random((</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># float64 类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ✔ 正确示例：转换为 float32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vectors_float32 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vectors_float64.astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;float32&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p><strong>数据结构</strong>：输入向量需为二维数组，形状为（num_vectors, dimension），其中num_vectors是向量的数量，dimension是单个向量的维度（所有向量维度必须一致）。例如：100 个 128 维向量 → 形状为 <code>（100, 128）</code>。</p></li><li><p><strong>数据来源适配</strong>：</p><ul><li><p><strong>NumPy数组</strong>：FAISS的首选输入格式，可直接通过add()方法添加。</p></li><li><p><strong>PyTorch/TensorFlow张量</strong>：需先转换为NumPy数组，再转换为float32类型，例如：<code>tensor.numpy().astype(&#39;float32&#39;)</code>。</p></li><li><p><strong>Python列表</strong>：需先通过np.array()转换为NumPy数组，再处理类型和形状。</p></li></ul></li></ul><h4 id="_3-2-2-向量维度约束" tabindex="-1">3.2.2 向量维度约束 <a class="header-anchor" href="#_3-2-2-向量维度约束" aria-label="Permalink to &quot;3.2.2 向量维度约束&quot;">​</a></h4><p>FAISS的索引对象在创建时会固定向量维度（由构造函数的参数指定），后续添加的向量必须与该维度一致，否则会抛出维度不匹配的错误。例如：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dimension </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 128</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss.IndexFlatL2(dimension)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 固定维度为128</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 正确：添加128维向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vectors_correct </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.random.random((</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)).astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;float32&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.add(vectors_correct)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 错误：添加64维向量（维度不匹配）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vectors_wrong </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.random.random((</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)).astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;float32&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.add(vectors_wrong)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 抛出错误：RuntimeError: Error in faiss::IndexFlatL2::add</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>注意：向量维度一旦通过索引构造函数确定，无法修改，若需处理不同维度的向量，需创建新的索引对象。</p><h3 id="_3-3-id映射机制-向量与自定义id的关联" tabindex="-1">3.3 ID映射机制：向量与自定义ID的关联 <a class="header-anchor" href="#_3-3-id映射机制-向量与自定义id的关联" aria-label="Permalink to &quot;3.3 ID映射机制：向量与自定义ID的关联&quot;">​</a></h3><p>默认情况下，FAISS为添加到索引的向量分配自增的整数ID（从0开始），但在实际应用中，我们常需要将向量与自定义ID（如图片ID、文本ID）关联。FAISS通过IndexIDMap包装类实现这一功能。</p><h4 id="_3-3-1-indexidmap的使用方法" tabindex="-1">3.3.1 IndexIDMap的使用方法 <a class="header-anchor" href="#_3-3-1-indexidmap的使用方法" aria-label="Permalink to &quot;3.3.1 IndexIDMap的使用方法&quot;">​</a></h4><p>IndexIDMap的作用是为基础索引（如IndexFlatL2）添加ID映射层，允许用户在添加向量时指定自定义ID，步骤如下：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dimension </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 128</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">num_vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 生成向量和自定义ID（例如图片ID：10001~10100）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.random.random((num_vectors, dimension)).astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;float32&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">custom_ids </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.arange(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10001</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_vectors).astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;int64&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自定义ID需为int64类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 创建基础索引，并使用IndexIDMap包装</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">base_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss.IndexFlatL2(dimension)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss.IndexIDMap(base_index)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 包装后支持自定义ID</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 添加向量时指定自定义ID（add_with_ids方法）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.add_with_ids(vectors, custom_ids)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;索引中的向量数量：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index.ntotal)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 检索时返回的是自定义ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query_vector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.random.random((</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dimension)).astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;float32&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">distances, indices </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.search(query_vector, k)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;查询结果自定义ID：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, indices)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出10001~10100范围内的ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;查询结果距离：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, distances)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="_3-3-2-核心注意事项" tabindex="-1">3.3.2 核心注意事项 <a class="header-anchor" href="#_3-3-2-核心注意事项" aria-label="Permalink to &quot;3.3.2 核心注意事项&quot;">​</a></h4><ul><li><strong>自定义ID类型</strong>：必须为64位整数（int64），否则会导致ID映射错误。</li><li><strong>ID唯一性</strong>：添加的自定义ID需唯一，若重复添加相同ID，后续添加的向量会覆盖之前的向量。</li><li><strong>索引操作兼容性</strong>：包装后的IndexIDMap支持基础索引的所有方法（如search、reset），但部分近似索引（如IndexIVFPQ）需先训练基础索引，再进行包装和添加ID。</li></ul><h2 id="_4-第一个faiss-示例" tabindex="-1">4 第一个FAISS 示例 <a class="header-anchor" href="#_4-第一个faiss-示例" aria-label="Permalink to &quot;4 第一个FAISS 示例&quot;">​</a></h2><blockquote><p><strong>学习要求</strong>：独立运行基础检索案例，理解检索流程</p></blockquote><p>本小节将通过一个完整的“随机向量精确检索”示例，串联FAISS的核心操作（向量生成、索引创建、向量添加、检索、结果解析），并详细解读基础API的使用方法。后续将拓展到SIFT图像特征向量检索，帮助大家理解FAISS在实际场景中的应用。</p><h3 id="_4-1-基础示例-随机向量精确检索" tabindex="-1">4.1 基础示例：随机向量精确检索 <a class="header-anchor" href="#_4-1-基础示例-随机向量精确检索" aria-label="Permalink to &quot;4.1 基础示例：随机向量精确检索&quot;">​</a></h3><p>本示例将生成一批随机高维向量作为“数据库向量”，再生成一个随机向量作为“查询向量”，使用IndexFlatL2（精确检索）找到与查询向量最相似的Top-K结果，并解析检索结果。</p><h4 id="_4-1-1-完整代码实现" tabindex="-1">4.1.1 完整代码实现 <a class="header-anchor" href="#_4-1-1-完整代码实现" aria-label="Permalink to &quot;4.1.1 完整代码实现&quot;">​</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FAISS基础示例：随机向量精确检索（IndexFlatL2）</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">流程：生成数据 → 创建索引 → 添加向量 → 执行检索 → 解析结果</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -------------------------- 1. 配置参数与生成数据 --------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 向量配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dimension </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 128</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 向量维度（模拟图像/文本特征向量）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 数据库向量数量（1万个）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 查询向量数量（5个）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 每个查询返回Top-10相似结果</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成数据库向量（float32类型，形状：(db_size, dimension)）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">np.random.seed(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 固定随机种子，保证结果可复现</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db_vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.random.random((db_size, dimension)).astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;float32&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成查询向量（形状：(query_size, dimension)）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query_vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.random.random((query_size, dimension)).astype(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;float32&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -------------------------- 2. 创建索引 --------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用IndexFlatL2（基于L2距离的精确检索索引）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 构造函数参数：向量维度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss.IndexFlatL2(dimension)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看索引状态（是否已训练，FAISS中精确索引无需训练，默认is_trained=True）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;索引是否已训练：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index.is_trained)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出：True</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;索引初始向量数量：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index.ntotal)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出：0（未添加向量）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -------------------------- 3. 向索引添加向量 --------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用add()方法添加数据库向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.add(db_vectors)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看添加后的索引状态</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;添加后索引向量数量：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index.ntotal)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出：10000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -------------------------- 4. 执行检索 --------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用search()方法执行检索，参数：查询向量、返回结果数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">distances, indices </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.search(query_vectors, k)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -------------------------- 5. 解析检索结果 --------------------------</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;=&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;检索结果解析（共</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">个查询，每个返回Top-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">）&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.format(query_size, k))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;=&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query_size):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">查询向量</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.format(i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;  最相似的</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">个向量ID：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.format(k, indices[i]))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;  对应的L2距离：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.format(np.round(distances[i], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)))  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保留4位小数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -------------------------- 6. 索引的其他常用操作 --------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 保存索引到磁盘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">faiss.write_index(index, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;faiss_flatl2_index.index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">索引已保存到：faiss_flatl2_index.index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 从磁盘加载索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">loaded_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> faiss.read_index(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;faiss_flatl2_index.index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;加载的索引向量数量：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loaded_index.ntotal)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出：10000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 清空索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">loaded_index.reset()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;清空后索引向量数量：&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loaded_index.ntotal)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出：0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h4 id="_4-1-2-代码关键步骤解读" tabindex="-1">4.1.2 代码关键步骤解读 <a class="header-anchor" href="#_4-1-2-代码关键步骤解读" aria-label="Permalink to &quot;4.1.2 代码关键步骤解读&quot;">​</a></h4><ol><li><strong>数据生成</strong>：使用NumPy的random模块生成随机向量，设置随机种子（np.random.seed(42)）确保结果可复现。需特别注意将向量类型转换为float32，符合FAISS要求。</li><li><strong>索引创建</strong>：IndexFlatL2是最简单的精确检索索引，无需训练即可直接使用，构造函数仅需传入向量维度。</li><li><strong>向量添加</strong>：add()方法接收二维float32数组，添加后通过ntotal属性查看索引中的向量总数，验证添加是否成功。</li><li><strong>检索执行</strong>：search()方法返回两个数组： distances：形状为（query_size, k），存储每个查询向量与检索结果的L2距离，距离越小表示相似度越高。</li><li><strong>indices</strong>：形状为（query_size, k），存储每个查询结果在数据库向量中的索引（即db_vectors的下标）。</li><li><strong>索引持久化</strong>：通过write_index()将索引保存到磁盘，后续可通过read_index()加载，避免重复创建索引，提高效率。</li></ol><h4 id="_4-1-3-运行结果说明" tabindex="-1">4.1.3 运行结果说明 <a class="header-anchor" href="#_4-1-3-运行结果说明" aria-label="Permalink to &quot;4.1.3 运行结果说明&quot;">​</a></h4><p>运行代码后，会输出以下关键信息：</p><ul><li>索引的训练状态和向量数量变化，验证向量添加和清空操作的有效性。</li><li>每个查询向量的Top-10相似结果ID和对应的L2距离，例如查询向量1的结果中，ID为xxx的向量距离最小，是最相似的向量。</li><li>索引保存和加载的提示，确认索引持久化操作成功。</li></ul><h3 id="_4-2-基础api总结" tabindex="-1">4.2 基础API总结 <a class="header-anchor" href="#_4-2-基础api总结" aria-label="Permalink to &quot;4.2 基础API总结&quot;">​</a></h3><p>通过以个示例，我们已掌握FAISS的核心基础API，现总结如下：</p><table tabindex="0"><thead><tr><th style="text-align:left;">API方法</th><th style="text-align:left;">功能描述</th><th style="text-align:left;">关键参数</th></tr></thead><tbody><tr><td style="text-align:left;">faiss.IndexFlatL2(d)</td><td style="text-align:left;">创建基于L2距离的精确检索索引</td><td style="text-align:left;">d：向量维度</td></tr><tr><td style="text-align:left;">index.add(x)</td><td style="text-align:left;">向索引添加向量</td><td style="text-align:left;">x：形状为（N, d）的float32数组</td></tr><tr><td style="text-align:left;">index.search(x, k)</td><td style="text-align:left;">检索与x最相似的k个向量</td><td style="text-align:left;">x：查询向量数组；k：返回结果数</td></tr><tr><td style="text-align:left;">index.save(filename)</td><td style="text-align:left;">将索引保存到磁盘</td><td style="text-align:left;">filename：保存路径</td></tr><tr><td style="text-align:left;">faiss.read_index(filename)</td><td style="text-align:left;">从磁盘加载索引</td><td style="text-align:left;">filename：索引路径</td></tr><tr><td style="text-align:left;">index.reset()</td><td style="text-align:left;">清空索引中的所有向量</td><td style="text-align:left;">无</td></tr><tr><td style="text-align:left;">index.ntotal</td><td style="text-align:left;">属性，获取索引中的向量总数</td><td style="text-align:left;">无</td></tr></tbody></table><h2 id="本章小结" tabindex="-1">本章小结 <a class="header-anchor" href="#本章小结" aria-label="Permalink to &quot;本章小结&quot;">​</a></h2><p>本章作为FAISS的入门内容，核心围绕“认知-环境-结构-实践”展开：</p><ul><li>明确了FAISS的核心定位是“大规模向量检索库”，其优势在于高效性和硬件适配性，与Milvus等向量数据库形成互补。</li><li>掌握了Python/C++版本的环境搭建方法，重点解决了CUDA适配、依赖缺失等常见问题。</li><li>理解了Index类体系是FAISS的核心，掌握了精确检索索引（IndexFlatL2/IndexFlatIP）的使用，以及向量数据格式、维度约束和ID映射机制。</li><li>通过随机向量和SIFT图像特征两个示例，完整实践了FAISS的检索流程，掌握了add、search等基础API的使用。</li></ul><p>下一章将重点讲解FAISS的近似检索算法以及索引的性能优化方法，帮助大家应对更大规模的向量检索场景。</p>`,94)])])}const y=i(t,[["render",p]]);export{g as __pageData,y as default};
