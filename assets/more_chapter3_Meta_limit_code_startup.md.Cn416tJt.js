import{_ as n,o as e,c as l,ag as i,j as s,a as t}from"./chunks/framework.CzE6cJJL.js";const d="/easy-vecdb/images/image0.png",o="/easy-vecdb/images/image1.png",r="/easy-vecdb/images/table6.bmp",_=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"more/chapter3/Meta_limit/code/startup.md","filePath":"more/chapter3/Meta_limit/code/startup.md","lastUpdated":1766999133000}'),p={name:"more/chapter3/Meta_limit/code/startup.md"},h={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},c={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.791ex"},xmlns:"http://www.w3.org/2000/svg",width:"15.009ex",height:"2.861ex",role:"img",focusable:"false",viewBox:"0 -914.9 6633.9 1264.4","aria-hidden":"true"},k={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},u={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.791ex"},xmlns:"http://www.w3.org/2000/svg",width:"15.009ex",height:"2.861ex",role:"img",focusable:"false",viewBox:"0 -914.9 6633.9 1264.4","aria-hidden":"true"};function m(g,a,Q,T,b,y){return e(),l("div",null,[a[19]||(a[19]=i(`<h2 id="step-by-step" tabindex="-1">Step by step <a class="header-anchor" href="#step-by-step" aria-label="Permalink to &quot;Step by step&quot;">​</a></h2><ol><li>首先，打开魔搭社区<a href="https://www.modelscope.cn/my/mynotebook" target="_blank" rel="noreferrer">https://www.modelscope.cn/my/mynotebook</a> 进入自己的主页，打开GPU环境的notebook。</li><li>然后打开终端，输入以下指令</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  https://github.com/google-deepmind/limit.git</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>然后，因为代码中device参数的问题，你需要把我的代码复制过去，替换掉对应的文件。保存。 <blockquote><p>将本教程中free_embedding_experiment.py文件替换掉你clone下来的代码的free_embedding_experiment.py文件。</p></blockquote></li><li>创建虚拟环境</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> venv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> venv</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 记得每次启动的时候都要进入虚拟环境！</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> venv/bin/activate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="4"><li>下载下来后，你可以看到limit文件夹，然后你需要进入里面的code文件夹，然后在终端执行</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> requirements.txt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="5"><li><p>运行generate_li......文件，按照步骤一步一步来即可，生成所需要的数据集，关于数据集的含义，后面再讲解，先看到效果，再学习概念理论。</p></li><li><p>运行成功后，执行以下指令，运行测试</p></li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> free_embedding_experiment.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --d=4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --k=2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --enable_critical_n_search=11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --results_output_path=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;result_d4_k2.json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --device=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cpu&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>或者使用GPU，但在使用GPU之前，如果你已经按照了JAX，请卸载（为什么呢？因为JAX为了轻量化，默认的 pip install jax 只安装CPU版本。您必须明确地安装为GPU编译的版本。）</p><blockquote><p>如果你想要尝试d=15这种高维度的，一定要使用gpu，cpu的处理速度太慢了，不过，对于效果而言，尝试d=4，这种低维度的就够了。 首先卸载当前的JAX然后重装GPU版本</p></blockquote><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jax</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jaxlib</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -U</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;jax[cuda12_pip]&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://storage.googleapis.com/jax-releases/jax_cuda_releases.html</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这个命令会非常慢，毕竟是国外的，但是等一会就好了，多重试几次</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后再执行下面的指令</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> free_embedding_experiment.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --d=4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --k=2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --enable_critical_n_search=11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --resultsg_output_path=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;result_d4_k2.json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --device=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpu&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果报错了，看看是不是版本冲突，</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jax</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>正常情况下，你删除jax后执行这个指令是看不到任何jax的输出的，如果有，看一看是不是某个jax没有卸载好，重新把它卸载掉即可。</p><p>然后再执行安装Gpu版本的jax，<strong>此处CUDA为12_1版本</strong>。</p><p>然后再次执行</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jax</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>次，您应该能看到三个包都被列出来了，类似下面这样（版本号可能会有细微差别）：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jax</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      0.4.30</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jax-cuda12-pjrt</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          0.6.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jaxlib</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                   0.4.30</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果少了某个，执行python -c &quot;import jax; print(jax.devices())&quot; 看一看输出什么。不行就再重新安装。</p><ol start="7"><li>为了更好的展现效果，你可以调整参数，将d调整为5、6 or other 然后输出文件路径改为result_d5_k2.json或者其他，这里我尝试d为4、5、6三种参数，生成了对应的三个json文件（在result目录下，如果你不想等待，可以直接使用，记得修改outplt文件中的地址为你生成的json文件路径）。</li><li>进入outplt.ipynb文件，依次执行，最终你将会看到效果图。</li></ol><h2 id="执行参数的含义" tabindex="-1">执行参数的含义 <a class="header-anchor" href="#执行参数的含义" aria-label="Permalink to &quot;执行参数的含义&quot;">​</a></h2><table tabindex="0"><thead><tr><th>参数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>--d</td><td>嵌入的维度</td><td>--d=8</td></tr><tr><td>--k</td><td>每个查询的相关文档数量</td><td>--k=2</td></tr><tr><td>--enable_critical_n_search</td><td>临界 N 搜索的起始值（初始文档数量）</td><td>--enable_critical_n_search=20</td></tr><tr><td>--results_output_path</td><td>实验结果保存的路径（JSON）</td><td>--results_output_path=&quot;results.json&quot;</td></tr><tr><td>--device</td><td>训练使用的设备（gpu/cpu/tpu）</td><td>--device=gpu</td></tr><tr><td>--learning_rate</td><td>学习率</td><td>--learning_rate=0.01</td></tr><tr><td>--num_iterations</td><td>最大训练步数</td><td>--num_iterations=100000</td></tr><tr><td>--show_progress</td><td>是否显示进度条</td><td>--show_progress=True</td></tr><tr><td>--early_stopping_patience</td><td>早停耐心轮数</td><td>--early_stopping_patience=1000</td></tr></tbody></table><h2 id="预估时间消耗" tabindex="-1">预估时间消耗 <a class="header-anchor" href="#预估时间消耗" aria-label="Permalink to &quot;预估时间消耗&quot;">​</a></h2><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> free_embedding_experiment.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --d=15</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --k=2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --enable_critical_n_search=11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --results_output_path=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;result_d15_k2.json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --device=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cpu&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看终端如下：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">I0908</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 16:19:06.376164</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 140021081243136</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> free_embedding_experiment.py:88]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Optimizing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (n=71,d=15,k=2):   2%</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 1701/100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [19:07&lt;17:57:08,  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1.52it/s,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> loss=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.9497</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> acc=0.9990]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_1-一轮-vs-一步" tabindex="-1">1. “一轮” vs “一步” <a class="header-anchor" href="#_1-一轮-vs-一步" aria-label="Permalink to &quot;1. “一轮” vs “一步”&quot;">​</a></h3><p>从开始优化 <code>n=10</code> 直到它完成，然后准备开始 <code>n=11</code>，这整个过程我们称之为“一轮”。</p><p>而现在看到的 <code>1351/100000</code>，是我们之前没有讨论到的、更细粒度的<strong>内部优化步骤</strong>。</p><h3 id="_2-详细解读" tabindex="-1">2. 详细解读 <a class="header-anchor" href="#_2-详细解读" aria-label="Permalink to &quot;2. 详细解读&quot;">​</a></h3><p><code>Optimizing (n=71,d=15,k=2):</code></p><ul><li>这告诉我们，脚本<strong>已经完成了 <code>n=70</code> 的优化</strong>，并且现在<strong>刚刚开始 <code>n=71</code> 这一轮</strong>。</li></ul><p><code>1%| | 1351/100000 [15:18&lt;18:00:06, 1.52it/s, loss=0.9506 acc=0.9994]</code></p><ul><li><code>100000</code>: 这是代码里设置的总优化**步骤(steps)**数量。为了让模型充分学习，作者设置了一个很大的数字（10万步）。</li><li><code>1351</code>: 这是在 <code>n=71</code> 这一轮里，目前已经完成了 <code>1351</code> 步，1351变到1352算是一次计算，但这只是10万步中的一小步，我们称之为<strong>一个step</strong>或<strong>一个batch</strong>。</li><li><code>[15:18&lt;18:00:06]</code>: <ul><li><code>15:18</code>: 表示 <code>n=71</code> 这一轮已经进行了<strong>15分18秒</strong>。</li><li><code>&lt;18:00:06</code>: 这是 <code>tqdm</code> 根据当前速度<strong>预估</strong>的剩余时间。它认为，光是跑完 <code>n=71</code> 这一轮，还需要<strong>18个小时</strong></li></ul></li><li><code>1.52it/s</code>: 当前的优化速度，每秒能完成约1.5个小步骤（iterations/steps）。</li></ul><hr><h2 id="数据集含义" tabindex="-1">数据集含义 <a class="header-anchor" href="#数据集含义" aria-label="Permalink to &quot;数据集含义&quot;">​</a></h2><p>这里详细解释一下 LIMIT 数据集的<strong>格式</strong>和<strong>用处</strong>。</p><p>这些数据是论文中&quot;Free Embedding Optimization&quot;实验的结果，<strong>它模拟了在不同维度 (d) 下，嵌入模型理论上能够捕获的文档组合数量</strong>。</p>`,42)),s("ul",null,[a[13]||(a[13]=i("<li><strong><code>d</code></strong>: 这是嵌入的维度。论文的核心观点是，<strong>嵌入的维度是限制模型表示文档组合能力的关键因素。</strong></li><li><strong><code>n</code></strong>: 这是文档的数量。在这些实验中，<code>n</code> 是指<strong>能够被模型成功表示的文档的最大数量</strong>，同时保持给定的维度 <code>d</code> 和 <code>k</code> (top-k 组合中的 <code>k</code>)。</li><li><strong><code>k</code></strong>: 这是 &quot;top-k&quot; 组合中的 <code>k</code> 值。在这些实验中，<code>k</code> 固定为 2，意味着模型需要识别出两个相关的文档。</li>",3)),s("li",null,[a[2]||(a[2]=s("strong",null,[s("code",null,"actual_q_generated")],-1)),a[3]||(a[3]=t(": 这代表在给定 ",-1)),a[4]||(a[4]=s("code",null,"n",-1)),a[5]||(a[5]=t(" 和 ",-1)),a[6]||(a[6]=s("code",null,"k",-1)),a[7]||(a[7]=t(" 的情况下，所有可能的 top-k 相关文档组合的实际数量。例如，如果 ",-1)),a[8]||(a[8]=s("code",null,"n=5",-1)),a[9]||(a[9]=t(" 且 ",-1)),a[10]||(a[10]=s("code",null,"k=2",-1)),a[11]||(a[11]=t("，则可能的组合数量为 ",-1)),s("mjx-container",h,[(e(),l("svg",c,[...a[0]||(a[0]=[i('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mfrac" transform="translate(458,0)"><g data-mml-node="mn" transform="translate(0,444) scale(0.707)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(0,-345) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(811.6,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mo" transform="translate(1547.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mfrac" transform="translate(2603.1,0)"><g data-mml-node="mrow" transform="translate(220,394) scale(0.707)"><g data-mml-node="mn"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(500,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1278,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(500,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1278,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g></g><rect width="1457.2" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(4578.1,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(5633.9,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)" style="stroke-width:3;"></path></g></g></g>',1)])])),a[1]||(a[1]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mrow",{"data-mjx-texclass":"ORD"},[s("mrow",{"data-mjx-texclass":"OPEN"},[s("mo",{minsize:"1.2em",maxsize:"1.2em"},"(")]),s("mfrac",{linethickness:"0"},[s("mn",null,"5"),s("mn",null,"2")]),s("mrow",{"data-mjx-texclass":"CLOSE"},[s("mo",{minsize:"1.2em",maxsize:"1.2em"},")")])]),s("mo",null,"="),s("mfrac",null,[s("mrow",null,[s("mn",null,"5"),s("mo",null,"×"),s("mn",null,"4")]),s("mrow",null,[s("mn",null,"2"),s("mo",null,"×"),s("mn",null,"1")])]),s("mo",null,"="),s("mn",null,"10")])],-1))]),a[12]||(a[12]=t("。",-1))]),a[14]||(a[14]=i("<li><strong><code>final_accuracy</code></strong> 和 <strong><code>max_accuracy_observed</code></strong>: 这些指标表示模型在给定维度 <code>d</code> 下成功<strong>捕获所有相关文档组合的准确性</strong>。1.0 的准确率意味着模型能够完美地表示所有组合。</li><li><strong><code>final_loss</code></strong> 和 <strong><code>best_loss_monitored</code></strong>: 这些是优化过程中的损失值。较低的损失值通常意味着更好的性能，因为模型能够更好地满足检索任务的约束。</li>",2))]),a[20]||(a[20]=i(`<p>了解完这些字段的含义后，<strong>如何通过数据得到论文的结论呢？</strong></p><p>回顾一下论文的结论：<strong>嵌入模型的表示能力受到其维度的限制，并且存在一个&quot;临界点&quot;，在这个点之后，模型即使在理论最佳情况下也无法完全捕获所有可能的文档组合。</strong></p><p>我们可以通过以下观察来印证这个结论：</p><ol><li><p><strong>维度 <code>d</code> 对准确率的影响：</strong></p><ul><li>不要忘记了，这里的n是能够被模型成功表示的文档的最大数量，d是嵌入向量的维度。</li></ul><ul><li><p>当 <code>d=4</code> 且 <code>n=5</code> 时，<code>actual_q_generated</code> 是 10，<code>final_accuracy</code> 是 1.0。这意味着在 <code>d=4</code> 的维度下，模型能够完美地表示这 10 种组合。</p></li><li><p>当 <code>d=4</code> 且 <code>n=6</code> 时，<code>actual_q_generated</code> 是 15，<code>final_accuracy</code> 仍然是 1.0。模型依然能够完美表示。</p></li><li><p>随着 <code>n</code> 的增加，<code>actual_q_generated</code> (即需要表示的组合数量) 也会迅速增加。</p></li><li><p>然而，当你查看 <code>n=11</code>, <code>n=12</code>, <code>n=13</code>, <code>n=14</code> 的结果时，会发现 <code>final_accuracy</code> 开始下降，并且不再是 1.0。例如，对于 <code>d=4</code> 和 <code>n=11</code>，<code>final_accuracy</code> 降到了 0.9090909090909091。这表明当文档数量 <code>n</code> 达到某个值时，即使维度 <code>d</code> 保持不变，模型也无法再完美地表示所有组合。</p></li><li><p>不过，d选择4、5、6这种极低的维度：这种情况下，实验结果更多地反映了维度过低导致的表示能力不足，而不是论文想要强调的即使在较高维度下，面对&quot;所有组合&quot;时的固有局限性。</p></li><li><p>我的建议是，为了更好地体现论文在实际情况下的限制，你应该至少从 d=32 开始，并尝试一些更高的维度。（我只是建议，你可不要真的尝试这些维度，太慢了。）</p><p>最低起点：d=32</p><p>这是论文中 SOTA 模型评估的最低维度（参见 Figure 3 和 Figure 4）。 从这个点开始，你可以直接与论文中的 SOTA 模型在低维度下的表现进行比较。 常见和有代表性的维度：d=128, 256, 512, 768, 1024</p><p>这些维度更接近真实世界中嵌入模型常用的维度，尤其是在各种预训练模型中。 d=768 和 d=1024 尤其重要，因为它们是许多主流语言模型（如 BERT base/large, RoBERTa 等）的默认输出维度。 论文也明确指出 1024 维对应 400 万文档的 Critical-n，这在一定程度上是实际应用中的一个限制。</p><p>这些是论文中评估的最高维度，能够显示在更大规模文档集下（如几百万到几亿），即便是非常大的维度也无法满足所有组合的需求。 如果你的实验资源有限，可以优先考虑上述&quot;常见和有代表性&quot;的维度，我这里就只尝试了4、5、6了。</p></li></ul></li><li><p><strong>&quot;临界点&quot;的体现：</strong></p><ul><li>对于每个固定的维度 <code>d</code>，会有一个 <code>n</code> 的最大值，模型能够以 100% 的准确率表示所有组合。一旦 <code>n</code> 超过这个&quot;临界值&quot;，准确率就会下降。</li><li>表格 6 (Table 6) 中列出了 <code>d</code> 和对应的 <code>Critical-n</code> 值，这直接展示了在不同的嵌入维度 <code>d</code> 下，模型能够成功表示所有 top-k 组合的最大文档数量 <code>n</code>。例如，当 <code>d=4</code> 时，<code>Critical-n</code> 是 10。这与你在 <code>n=11</code> 观察到的准确率下降相吻合。</li></ul></li><li><p><strong>损失值的变化：</strong></p><ul><li>随着 <code>n</code> 超过 <code>Critical-n</code>，即使损失值可能会持续下降，但准确率却无法达到 1.0。这进一步支持了即使在最佳优化情况下，模型也无法完美捕获所有组合的观点。</li></ul></li></ol><p>简而言之，这些数据实证地验证了，对于给定的嵌入维度 <code>d</code> 和 <code>k</code>，存在一个文档数量 <code>n</code> 的上限，超过这个上限，即使是经过最佳优化的嵌入模型也无法完美地表示所有可能的 top-k 文档组合。这就是论文所指出的<strong>嵌入模型在表示能力上的理论局限性</strong>。</p><hr><h2 id="_1-数据集格式" tabindex="-1">1. 数据集格式 <a class="header-anchor" href="#_1-数据集格式" aria-label="Permalink to &quot;1. 数据集格式&quot;">​</a></h2><h3 id="主要包含哪些内容" tabindex="-1">主要包含哪些内容？ <a class="header-anchor" href="#主要包含哪些内容" aria-label="Permalink to &quot;主要包含哪些内容？&quot;">​</a></h3><p>从 Notebook 的结构来看，LIMIT 数据集主要由以下几部分组成：</p><h4 id="_1-用户数据" tabindex="-1">1 用户数据 <a class="header-anchor" href="#_1-用户数据" aria-label="Permalink to &quot;1 用户数据&quot;">​</a></h4><ul><li><strong>名字和姓氏</strong>：从公开源下载大量的英文名字和姓氏，组合成唯一用户，例如：<code>Alice Smith</code>, <code>Bob Johnson</code>。</li><li><strong>唯一性</strong>：去重后有约2700多个名字，1000多个姓氏。可以组成上百万个独立用户。</li></ul><h4 id="_2-物品数据" tabindex="-1">2 物品数据 <a class="header-anchor" href="#_2-物品数据" aria-label="Permalink to &quot;2 物品数据&quot;">​</a></h4><ul><li><strong>items_to_like</strong>：这是一个超长的物品列表，包括： <ul><li>食物（水果、蔬菜、肉类、饮料）</li><li>动物（宠物、野生动物、昆虫等）</li><li>植物（花、树、草药等）</li><li>自然现象（雨、雪、云、月亮等）</li><li>运动与活动（足球、游泳、徒步等）</li><li>其他类别（蛋糕、糖果、面包、调味料等）</li></ul></li></ul><h4 id="_3-用户偏好" tabindex="-1">3 用户偏好 <a class="header-anchor" href="#_3-用户偏好" aria-label="Permalink to &quot;3 用户偏好&quot;">​</a></h4><ul><li><strong>格式举例</strong>： <ul><li>每个用户可以&quot;喜欢&quot;若干物品，通常以表格或 JSON 的形式存储： <ul><li>CSV:<table tabindex="0"><thead><tr><th>user_name</th><th>item</th></tr></thead><tbody><tr><td>Alice Smith</td><td>Apple</td></tr><tr><td>Bob Johnson</td><td>Soccer</td></tr></tbody></table></li><li>JSON:<div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Alice Smith&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;likes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Apple&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Soccer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Rain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Bob Johnson&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;likes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Banana&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Basketball&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li></ul></li><li><strong>生成方式</strong>：可以随机分配每个用户喜欢的物品数量（如每人5-10个），根据实际需要生成交互数据。</li></ul><hr><h2 id="结果文件的含义" tabindex="-1">结果文件的含义 <a class="header-anchor" href="#结果文件的含义" aria-label="Permalink to &quot;结果文件的含义&quot;">​</a></h2><ul><li>&quot;final_accuracy&quot;：每个 N 的最终准确率</li><li>&quot;final_loss&quot;：优化终点的 loss</li><li>&quot;max_accuracy_observed&quot;：整个 10w 次迭代中的最大准确率</li><li>&quot;actual_q_generated&quot;：实际采样到的 query/相关文档配置总数</li><li>&quot;optimization_duration_seconds&quot;：优化过程所用时间</li><li>&quot;accuracies&quot;/&quot;losses&quot;：每隔一段迭代记录的准确率/loss 曲线，可用于画图分析模型收敛过程</li></ul><p>我们从d=3的结果文件来看，这些数据是论文中&quot;Free Embedding Optimization&quot;实验的结果，它模拟了在不同维度 (d) 下，嵌入模型理论上能够捕获的文档组合数量。这些数据对于理解论文的核心结论至关重要。</p><p>让我来解释一下这些数据的含义，以及它们如何支持论文的结论：</p><ul><li><p>d: 这是嵌入的维度。论文的核心观点是，嵌入的维度是限制模型表示文档组合能力的关键因素。</p></li><li><p>n: 这是文档的数量。在这些实验中，n 是指能够被模型成功表示的文档的最大数量，同时保持给定的维度 d 和 k (top-k 组合中的 k)。</p></li><li><p>k: 这是 &quot;top-k&quot; 组合中的 k 值。在这些实验中，k 固定为 2，意味着模型需要识别出两个相关的文档。</p></li></ul>`,21)),s("p",null,[a[17]||(a[17]=t("actual_q_generated: 这代表在给定 n 和 k 的情况下，所有可能的 top-k 相关文档组合的实际数量。例如，如果 n=5 且 k=2，则可能的组合数量为 ",-1)),s("mjx-container",k,[(e(),l("svg",u,[...a[15]||(a[15]=[i('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="TeXAtom" data-mjx-texclass="OPEN"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="28" d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mfrac" transform="translate(458,0)"><g data-mml-node="mn" transform="translate(0,444) scale(0.707)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(0,-345) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="CLOSE" transform="translate(811.6,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="29" d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mo" transform="translate(1547.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mfrac" transform="translate(2603.1,0)"><g data-mml-node="mrow" transform="translate(220,394) scale(0.707)"><g data-mml-node="mn"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(500,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1278,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(500,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1278,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g></g><rect width="1457.2" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(4578.1,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(5633.9,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)" style="stroke-width:3;"></path></g></g></g>',1)])])),a[16]||(a[16]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mrow",{"data-mjx-texclass":"ORD"},[s("mrow",{"data-mjx-texclass":"OPEN"},[s("mo",{minsize:"1.2em",maxsize:"1.2em"},"(")]),s("mfrac",{linethickness:"0"},[s("mn",null,"5"),s("mn",null,"2")]),s("mrow",{"data-mjx-texclass":"CLOSE"},[s("mo",{minsize:"1.2em",maxsize:"1.2em"},")")])]),s("mo",null,"="),s("mfrac",null,[s("mrow",null,[s("mn",null,"5"),s("mo",null,"×"),s("mn",null,"4")]),s("mrow",null,[s("mn",null,"2"),s("mo",null,"×"),s("mn",null,"1")])]),s("mo",null,"="),s("mn",null,"10")])],-1))]),a[18]||(a[18]=t("。",-1))]),a[21]||(a[21]=i('<p>final_accuracy 和 max_accuracy_observed: 这些指标表示模型在给定维度 d 下成功捕获所有相关文档组合的准确性。1.0 的准确率意味着模型能够完美地表示所有组合。</p><p>final_loss 和 best_loss_monitored: 这些是优化过程中的损失值。较低的损失值通常意味着更好的性能，因为模型能够更好地满足检索任务的约束。</p><h2 id="如何通过数据得到论文的结论" tabindex="-1">如何通过数据得到论文的结论： <a class="header-anchor" href="#如何通过数据得到论文的结论" aria-label="Permalink to &quot;如何通过数据得到论文的结论：&quot;">​</a></h2><p>论文的结论是，嵌入模型的表示能力受到其维度的限制，并且存在一个&quot;临界点&quot;（critical-n），在这个点之后，模型即使在理论最佳情况下也无法完全捕获所有可能的文档组合。 你可以通过以下观察来印证这个结论：</p><p>维度 d 对准确率的影响：</p><ul><li><p>当 d=4 且 n=5 时，actual_q_generated 是 10，final_accuracy 是 1.0。这意味着在 d=4 的维度下，模型能够完美地表示这 10 种组合。</p></li><li><p>当 d=4 且 n=6 时，actual_q_generated 是 15，final_accuracy 仍然是 1.0。模型依然能够完美表示。</p></li></ul><p>随着 n 的增加，actual_q_generated (即需要表示的组合数量) 也会迅速增加。</p><p>然而，当你查看 n=11, n=12, n=13, n=14 的结果时，会发现 final_accuracy 开始下降，并且不再是 1.0。例如，对于 d=4 和 n=11，final_accuracy 降到了 0.9090909090909091。这表明当文档数量 n 达到某个值时，即使维度 d 保持不变，模型也无法再完美地表示所有组合。</p><h3 id="临界点-的体现" tabindex="-1">&quot;临界点&quot;的体现： <a class="header-anchor" href="#临界点-的体现" aria-label="Permalink to &quot;&quot;临界点&quot;的体现：&quot;">​</a></h3><p>对于每个固定的维度 d，会有一个 n 的最大值，模型能够以 100% 的准确率表示所有组合。一旦 n 超过这个&quot;临界值&quot;，准确率就会下降。</p><p>表格 6 (Table 6) 中列出了 d 和对应的 Critical-n 值，这直接展示了在不同的嵌入维度 d 下，模型能够成功表示所有 top-k 组合的最大文档数量 n。例如，当 d=4 时，Critical-n 是 10。这与你在 n=11 观察到的准确率下降相吻合。</p><h3 id="损失值的变化" tabindex="-1">损失值的变化： <a class="header-anchor" href="#损失值的变化" aria-label="Permalink to &quot;损失值的变化：&quot;">​</a></h3><p>随着 n 超过 Critical-n，即使损失值可能会持续下降，但准确率却无法达到 1.0。这进一步支持了即使在最佳优化情况下，模型也无法完美捕获所有组合的观点。</p><p>简而言之，这些数据实证地验证了，对于给定的嵌入维度 d 和 k，存在一个文档数量 n 的上限，超过这个上限，即使是经过最佳优化的嵌入模型也无法完美地表示所有可能的 top-k 文档组合。这就是论文所指出的嵌入模型在表示能力上的理论局限性。</p><h2 id="结果图片的含义" tabindex="-1">结果图片的含义 <a class="header-anchor" href="#结果图片的含义" aria-label="Permalink to &quot;结果图片的含义&quot;">​</a></h2><p><img src="'+d+'" alt=""></p><p>这张图表展示了在特定嵌入维度 d 和 k（在这个实验中 d=4, k=2）下，随着文档数量 N 的增加，最终准确率 (final_accuracy) 的变化。</p><p>X 轴 (N)：这代表了文档的数量。在这些实验中，N 的值从 5 开始逐渐增加。</p><p>Y 轴 (final_accuracy)：这表示模型在给定 N 值下，能够正确捕获所有 top-k 相关文档组合的准确率。1.00 表示 100% 的准确率，意味着模型完美地完成了任务。</p><p>这张图直观地展示了论文中关于嵌入模型表示能力局限性的核心观点：嵌入模型的表示能力是有限的，并且当需要处理的文档组合数量超过某个临界值时，即使是简单任务，模型也无法完美完成。</p><p>初始阶段的高准确率：你可以看到，当 N 较小（例如 N=5, N=6, N=7）时，final_accuracy 保持在 1.00，这意味着模型能够完美地表示所有组合。这与我们之前看到的数据结果一致，表明在文档数量不多时，模型可以很好地工作。</p><p>&quot;临界点&quot;的出现：当 N 增加到 8 之后，图表上出现了一个转折点。虽然在 N=8 时准确率仍然是 1.00，但随后在 N 进一步增加时，final_accuracy 开始显著下降（例如，N=10 时大约是 0.96，N=11 时大约是 0.91）。这个下降趋势表明，随着需要表示的文档组合数量的增加，即使是经过优化的嵌入模型也无法再保持 100% 的准确率。</p><p>表示能力的局限性：准确率的下降清楚地表明，对于给定的嵌入维度（这里是 d=4），存在一个文档数量的&quot;临界值&quot;（Critical-n）。一旦文档数量超过这个值，模型就无法完全捕获所有可能的文档组合。这张图形象地展示了表格 6 中 d=4 对应的 Critical-n 值（即 10）以及之后准确率的下降。</p><p>现在我们综合一下，当d=4\\5\\6的时候，结果图以及其为我们所展示的含义</p><p><img src="'+o+'" alt=""></p><p>这张图表通过三条不同颜色的线，描绘了在 <code>k=2</code> 的情况下，不同嵌入维度 (<code>d=4</code>, <code>d=5</code>, <code>d=6</code>) 如何影响模型识别所有可能文档组合的准确率。 <strong>从图中我们可以看到：</strong></p><ul><li><p><strong>维度 <code>d</code> 对&quot;临界点&quot;的影响</strong>：</p><ul><li>对于 <code>d=4</code> (蓝色线)，准确率在文档数量 <code>N=10</code> 时开始从 1.00 下降。这意味着当维度为 4 时，模型能够完美表示的最大文档数量（<code>Critical-n</code>）是 10。</li><li>对于 <code>d=5</code> (橙色线)，准确率在文档数量 <code>N=14</code> 时开始从 1.00 下降。这意味着当维度为 5 时，<code>Critical-n</code> 是 14。</li><li>对于 <code>d=6</code> (绿色线)，准确率在文档数量 <code>N=19</code> 时开始从 1.00 下降。这意味着当维度为 6 时，<code>Critical-n</code> 是 19。</li><li>...</li><li>这明确表明，<strong>嵌入维度越高，模型能够完美表示所有可能组合的文档数量就越多</strong>。</li></ul></li><li><p><strong>论文结论的直观展示</strong>：</p><ul><li>这张图直接展示了论文的核心观点：<strong>嵌入模型的表示能力受到其维度的根本性限制</strong>。</li><li>对于每个固定的维度，都存在一个文档数量的上限（即 <code>Critical-n</code>），超过这个上限，即使是理想的嵌入模型也无法完美地表示所有可能的文档组合。更高的维度确实允许模型处理更多的文档，但这种局限性仍然存在。</li></ul></li></ul><p>这张图表的数据与论文中的 Table 6 是吻合的。Table 6 列出的 <code>Critical-n</code> 值就是图中准确率首次从 1.00 下降时的 <code>N</code> 值。</p><p><img src="'+r+'" alt=""></p><ul><li>Table 6 显示 <code>d=4</code> 对应 <code>Critical-n=10</code>。</li><li><code>d=5</code> 对应 <code>Critical-n=14</code>。</li><li><code>d=6</code> 对应 <code>Critical-n=19</code>。</li></ul><p>如果你尝试 128 或 1024 维度的临界值，正如我们之前讨论的，理论上它们能够表示的文档数量会更多（如 Table 6 中的外推值）。然而，<strong>计算这些高维度的 <code>Critical-n</code> 会变得非常复杂和耗时</strong>，因为可能的文档组合数量会呈指数级增长，论文中也提到了计算的难度，所以，试一试低维的就可以，剩下的时间去吃个大盘鸡(　o=^•ェ•)o🍚。</p>',31))])}const C=n(p,[["render",m]]);export{_ as __pageData,C as default};
